<!DOCTYPE html>
<html lang="en" class="scroll-smooth bg-[#f8fafc]">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Instrumental Music School | FUBC Band</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/abcjs@6.2.2/dist/abcjs-basic-min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/abcjs@6.2.2/abcjs-audio.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <link rel="icon" type="image/png" href="/social-logo.png?v=2">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'], heading: ['Montserrat', 'sans-serif'] },
                    colors: { pageBg: '#f8fafc', textMain: '#0f172a', textMuted: '#64748b', brass: '#b45309', brassLight: '#d97706', surface: '#ffffff' },
                    animation: { 
                        'fade-in-up': 'fadeInUp 0.6s ease-out forwards',
                        'marquee-mobile': 'marquee 25s linear infinite',
                        'marquee-desktop': 'marquee 45s linear infinite',
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite'
                    },
                    keyframes: {
                        fadeInUp: { '0%': { opacity: '0', transform: 'translateY(20px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        marquee: { '0%': { transform: 'translateX(0%)' }, '100%': { transform: 'translateX(-100%)' } }
                    }
                }
            }
        }
    </script>
    <style>
        [x-cloak] { display: none !important; }
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 24px; width: 24px; border-radius: 50%; background: #b45309; margin-top: -10px; cursor: pointer; border: 2px solid white; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #e2e8f0; border-radius: 99px; }
        
        #print-staves { display: none; }
        @media print { body > *:not(#print-staves) { display: none !important; } #print-staves { display: block !important; background: white; width: 100%; } .stave { border-bottom: 1px solid black; margin-bottom: 8px; height: 1px; width: 100%; } .stave-group { margin-bottom: 40px; } @page { margin: 0.5in; } }
        
        .hero-bg { background-image: url('https://images.unsplash.com/photo-1573871669414-010dbf73ca84?q=80&w=2071&auto=format&fit=crop'); background-size: cover; background-position: center; }
        .abcjs-container svg { max-width: 100%; height: auto; border-radius: 0.5rem; }
        
        .abcjs-inline-audio { background-color: #0f172a !important; border-radius: 12px !important; padding: 12px 24px !important; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1) !important; margin: 0 auto !important; max-width: 500px; display: flex; align-items: center; justify-content: center; border: 2px solid #b45309 !important; }
        .abcjs-btn { color: white !important; fill: white !important; background-color: #1e293b !important; border-radius: 50% !important; transition: all 0.2s ease !important; }
        .abcjs-btn:hover { background-color: #b45309 !important; transform: scale(1.05); }
        .abcjs-time-display { color: #f8fafc !important; font-family: ui-monospace, monospace !important; font-weight: bold !important; font-size: 14px !important;}
        .abcjs-midi-progress-background { background-color: #334155 !important; border: none !important;}
        .abcjs-midi-progress-indicator { background-color: #b45309 !important; }
    </style>
</head>

<body class="text-textMain antialiased bg-pageBg overflow-x-hidden" x-data="schoolApp" @scroll.window="scrollY = window.pageYOffset; scrollProgress = (window.pageYOffset / (document.documentElement.scrollHeight - window.innerHeight)) * 100">

    <div class="fixed top-0 left-0 h-1.5 bg-gradient-to-r from-brass to-brassLight z-[100] shadow-md transition-all duration-150 ease-linear" :style="'width: ' + scrollProgress + '%'"></div>
    <div id="print-staves"></div>

    <div x-show="profileModalOpen" x-transition.opacity class="fixed inset-0 z-[120] flex items-center justify-center bg-slate-900/90 backdrop-blur-md p-4 w-full h-full" x-cloak>
        <div @click.away="profileModalOpen = false" class="bg-white rounded-3xl w-full max-w-lg max-h-[90vh] flex flex-col shadow-2xl overflow-hidden relative">
            
            <div x-show="!currentUser" class="p-8 flex flex-col items-center justify-center text-center">
                <div class="w-20 h-20 bg-brass/10 rounded-full flex items-center justify-center mb-6">
                    <svg class="w-10 h-10 text-brass" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>
                </div>
                <h2 class="text-2xl font-bold font-heading text-slate-900 mb-2">Student Portal</h2>
                <p class="text-sm text-slate-500 mb-8" x-text="authMode === 'login' ? 'Enter your name and 4-digit PIN.' : 'Use the Access Code provided by the conductor.'"></p>
                
                <div class="w-full max-w-xs space-y-4">
                    <input x-model="authForm.name" type="text" placeholder="First Name" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3.5 text-sm font-bold text-slate-700 focus:border-brass focus:outline-none">
                    <input x-model="authForm.pin" type="password" placeholder="4-Digit PIN" pattern="\d{4}" maxlength="4" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3.5 text-lg focus:border-brass focus:outline-none text-center tracking-[0.5em] font-mono text-slate-700">
                    
                    <input x-show="authMode === 'register'" x-model="authForm.code" type="text" placeholder="Class Access Code" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3.5 text-sm font-bold text-slate-700 focus:border-brass focus:outline-none uppercase tracking-widest text-center" x-cloak>
                    
                    <button @click="handleAuth()" class="w-full bg-slate-900 text-white font-bold uppercase tracking-widest text-xs py-4 rounded-xl hover:bg-brass transition-colors shadow-md mt-4 relative disabled:opacity-50" :disabled="authLoading">
                        <span x-show="!authLoading" x-text="authMode === 'login' ? 'Secure Login' : 'Create Account'"></span>
                        <span x-show="authLoading" x-cloak>Processing...</span>
                    </button>
                </div>
                
                <button @click="authMode = authMode === 'login' ? 'register' : 'login'" class="mt-8 text-[10px] font-bold text-slate-400 hover:text-brass uppercase tracking-widest" x-text="authMode === 'login' ? 'Need an account? Sign up' : 'Already have an account? Login'"></button>
                
                <button @click="profileModalOpen = false" class="absolute top-4 right-4 text-slate-300 hover:text-slate-600"><svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg></button>
            </div>

            <div x-show="currentUser" class="flex flex-col h-full" x-cloak>
                <div class="p-6 border-b border-slate-100 bg-slate-50 flex justify-between items-center relative overflow-hidden flex-shrink-0">
                    <div class="absolute inset-0 bg-brass/10"></div>
                    <div class="flex items-center gap-4 relative z-10">
                        <div class="w-16 h-16 bg-slate-900 rounded-full flex items-center justify-center text-white text-2xl font-black font-heading shadow-md" x-text="currentUser?.name ? currentUser.name.charAt(0).toUpperCase() : '?'"></div>
                        <div>
                            <h2 class="font-heading text-2xl font-bold text-slate-900" x-text="currentUser?.name"></h2>
                            <p class="text-xs font-bold uppercase tracking-widest mt-1" :class="getRankColor()" x-text="getRankName()"></p>
                        </div>
                    </div>
                    <button @click="profileModalOpen = false" class="text-slate-400 hover:text-brass transition-colors relative z-10"><svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg></button>
                </div>
                
                <div class="p-6 flex-grow overflow-y-auto bg-white space-y-8">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-slate-50 border border-slate-100 p-4 rounded-2xl flex flex-col items-center justify-center text-center shadow-sm">
                            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">Total Time</span>
                            <div class="text-3xl font-black text-slate-900 leading-none">
                                <span x-text="Math.floor((currentUser?.total_minutes || 0) / 60)"></span><span class="text-sm font-bold text-slate-500 ml-1">h</span>
                                <span x-text="(currentUser?.total_minutes || 0) % 60"></span><span class="text-sm font-bold text-slate-500 ml-1">m</span>
                            </div>
                        </div>
                        <div class="bg-slate-50 border border-slate-100 p-4 rounded-2xl flex flex-col items-center justify-center text-center shadow-sm">
                            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">Current Streak</span>
                            <div class="text-3xl font-black text-brass leading-none">
                                <span x-text="currentUser?.streak || 0"></span><span class="text-sm font-bold text-slate-500 ml-1">days</span>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="font-heading text-sm font-bold text-slate-900 uppercase tracking-widest mb-3 border-b border-slate-100 pb-2">This Week's Activity</h3>
                        <div class="flex justify-between items-center bg-slate-50 p-4 rounded-xl border border-slate-200">
                            <template x-for="(day, index) in weekDays" :key="index">
                                <div class="flex flex-col items-center gap-2">
                                    <span class="text-[10px] font-bold text-slate-400" x-text="day"></span>
                                    <div class="w-8 h-8 sm:w-10 sm:h-10 rounded-full flex items-center justify-center transition-all duration-300"
                                         :class="hasPracticedOnDay(index) ? 'bg-emerald-100 text-emerald-600 border border-emerald-200 shadow-sm scale-110' : (index === currentDayOfWeek ? 'bg-white border-2 border-slate-300' : 'bg-white border border-slate-200')">
                                        <svg x-show="hasPracticedOnDay(index)" class="w-4 h-4 sm:w-5 sm:h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
                
                <div class="p-4 bg-slate-50 border-t border-slate-100 flex justify-between items-center flex-shrink-0">
                    <p class="text-[9px] text-emerald-600 font-bold uppercase tracking-widest flex items-center gap-1"><span class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></span> Cloud Synced</p>
                    <button @click="logout()" class="text-[10px] font-bold text-slate-400 hover:text-red-500 uppercase tracking-widest">Logout</button>
                </div>
            </div>
        </div>
    </div>

    <div x-show="fullScreenModalOpen" x-transition.opacity class="fixed inset-0 z-[110] flex items-center justify-center bg-slate-900/95 backdrop-blur-md p-4 w-full h-full" x-cloak>
        <div @click.away="closeFullScreen()" class="bg-white rounded-2xl w-full max-w-5xl h-full max-h-[90vh] flex flex-col shadow-2xl overflow-hidden relative">
            <div class="flex justify-between items-center p-4 sm:p-6 border-b border-slate-100 bg-slate-50 flex-shrink-0">
                <h3 class="font-heading text-lg sm:text-xl font-bold text-slate-900 tracking-wider truncate mr-4">
                    <span x-show="lang === 'en'" x-text="currentModalData.title_en"></span>
                    <span x-show="lang === 'ua'" x-text="currentModalData.title_ua"></span>
                </h3>
                <button @click="closeFullScreen()" class="text-slate-400 hover:text-brass transition-colors focus:outline-none p-2 rounded-full hover:bg-slate-200 flex-shrink-0">
                    <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
            </div>
            
            <div class="bg-slate-100 border-b-2 border-slate-200 p-4 sticky top-0 z-20 shadow-sm flex flex-col items-center justify-center">
                <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2"><span x-show="lang === 'en'">Auto-Play Synth</span><span x-show="lang === 'ua'" x-cloak>Авто-Плеєр</span></span>
                <div id="audio-control" class="w-full"></div>
            </div>

            <div class="p-4 sm:p-8 flex-grow overflow-auto bg-white flex items-start justify-center relative w-full">
                <div id="abc-fullscreen" class="w-full"></div>
            </div>
        </div>
    </div>

    <nav class="sticky top-0 z-40 bg-slate-100/95 backdrop-blur-md border-b border-slate-200/80 shadow-sm transition-colors duration-300 w-full max-w-[100vw]" :class="mobileMenuOpen ? 'bg-slate-100 border-transparent' : ''">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative w-full">
            <div class="flex justify-between items-center h-16 w-full">
                <a href="/" class="flex items-center gap-2 sm:gap-3 hover:opacity-80 transition-opacity group z-50 relative shrink-0">
                    <div class="font-heading font-bold text-lg sm:text-xl md:text-2xl tracking-[0.1em] sm:tracking-[0.15em] text-slate-900 leading-none">
                        FUBC <span class="text-brass block text-[9px] sm:text-[10px] md:text-xs font-semibold tracking-[0.2em] sm:tracking-[0.35em] mt-0.5 group-hover:text-brassLight transition-colors">MUSIC SCHOOL</span>
                    </div>
                </a>
                
                <div class="md:hidden flex items-center gap-2 sm:gap-4 relative z-50 shrink-0">
                    <button @click="openProfile()" class="text-[10px] font-bold text-slate-700 hover:text-brass transition-colors uppercase tracking-widest border border-slate-200 px-2.5 py-1.5 rounded-full bg-white flex-shrink-0 flex items-center gap-1 shadow-sm">
                        <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                    </button>
                    <button @click="mobileMenuOpen = !mobileMenuOpen" class="p-2 text-slate-800 hover:text-brass transition-colors focus:outline-none flex-shrink-0">
                        <svg x-show="!mobileMenuOpen" class="w-6 h-6 sm:w-7 sm:h-7 transform transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/></svg>
                        <svg x-show="mobileMenuOpen" class="w-6 h-6 sm:w-7 sm:h-7 transform transition-transform duration-300 rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" x-cloak><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
                    </button>
                </div>

                <div class="hidden md:flex items-center gap-6 relative z-50 shrink-0">
                    <button @click="lang = lang === 'en' ? 'ua' : 'en'; $nextTick(() => { renderWarmups(); renderScales(); });" class="text-xs font-bold text-slate-500 hover:text-slate-900 transition-colors uppercase tracking-widest border border-slate-200 px-3 py-1.5 rounded-full hover:border-brass/50 bg-slate-50 transition-all duration-200 hover:shadow-sm">
                        <span :class="lang === 'en' ? 'text-brass font-extrabold' : ''">EN</span><span class="text-slate-300 px-1">/</span><span :class="lang === 'ua' ? 'text-brass font-extrabold' : ''">UA</span>
                    </button>
                    <a href="#warmups" class="font-bold text-xs uppercase tracking-widest text-slate-500 hover:text-brass transition-colors"><span x-show="lang === 'en'">Warm-Ups</span><span x-show="lang === 'ua'" x-cloak>Розминка</span></a>
                    <a href="#scales" class="font-bold text-xs uppercase tracking-widest text-slate-500 hover:text-brass transition-colors"><span x-show="lang === 'en'">Scales</span><span x-show="lang === 'ua'" x-cloak>Гамми</span></a>
                    <a href="#setlist" class="font-bold text-xs uppercase tracking-widest text-slate-500 hover:text-brass transition-colors"><span x-show="lang === 'en'">Practice</span><span x-show="lang === 'ua'" x-cloak>Заняття</span></a>
                    <button @click="openProfile()" class="text-xs font-bold text-slate-700 bg-white border border-slate-200 px-4 py-1.5 rounded-full hover:border-brass hover:text-brass transition-all duration-300 transform hover:-translate-y-0.5 hover:shadow-md uppercase tracking-widest flex items-center gap-1.5">
                        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                        <span x-show="lang === 'en'">Profile</span><span x-show="lang === 'ua'" x-cloak>Профіль</span>
                    </button>
                    <a href="/" class="text-xs font-bold text-white bg-slate-900 px-5 py-2 rounded-full hover:bg-brass transition-all duration-300 transform hover:-translate-y-0.5 hover:shadow-md uppercase tracking-widest"><span x-show="lang === 'en'">Main Band</span><span x-show="lang === 'ua'" x-cloak>Оркестр</span></a>
                </div>
            </div>
            
            <div class="absolute top-full left-0 w-full h-auto bg-slate-100 border-b-4 border-brass shadow-2xl md:hidden flex flex-col px-6 pb-6 transition-all duration-300 origin-top z-30" x-show="mobileMenuOpen" x-transition:enter="opacity-0 scale-y-0" x-transition:enter-end="opacity-100 scale-y-100" x-transition:leave="opacity-100 scale-y-100" x-transition:leave-end="opacity-0 scale-y-0" x-cloak>
                <div class="flex flex-col items-center justify-center space-y-5 mt-6">
                    <a href="#warmups" @click="mobileMenuOpen = false" class="text-xl font-heading font-bold text-slate-800 hover:text-brass transition-colors uppercase tracking-widest"><span x-show="lang === 'en'">Warm-Ups</span><span x-show="lang === 'ua'" x-cloak>Розминка</span></a>
                    <a href="#scales" @click="mobileMenuOpen = false" class="text-xl font-heading font-bold text-slate-800 hover:text-brass transition-colors uppercase tracking-widest"><span x-show="lang === 'en'">Scales</span><span x-show="lang === 'ua'" x-cloak>Гамми</span></a>
                    <a href="#setlist" @click="mobileMenuOpen = false" class="text-xl font-heading font-bold text-slate-800 hover:text-brass transition-colors uppercase tracking-widest"><span x-show="lang === 'en'">Practice</span><span x-show="lang === 'ua'" x-cloak>Заняття</span></a>
                    <div class="w-full h-px bg-slate-200 my-2"></div>
                    <a href="/" class="text-sm font-bold text-white bg-slate-900 px-8 py-3 rounded-full hover:bg-brass transition-colors uppercase tracking-widest shadow-sm"><span x-show="lang === 'en'">Main Band Site</span><span x-show="lang === 'ua'" x-cloak>Головний сайт</span></a>
                </div>
            </div>
        </div>
    </nav>

    <div class="relative w-full h-[350px] sm:h-[450px] bg-slate-900 overflow-hidden">
        <img src="https://images.unsplash.com/photo-1573871669414-010dbf73ca84?q=80&w=2071&auto=format&fit=crop" class="absolute inset-0 w-full h-full object-cover opacity-40 will-change-transform" :style="'transform: translateY(' + (scrollY * 0.4) + 'px)'" alt="Brass Instruments">
        <div class="absolute inset-0 bg-gradient-to-b from-slate-900/60 via-slate-900/30 to-slate-900"></div>
        <div class="absolute inset-0 flex flex-col items-center justify-center text-center px-4 pt-4 sm:pt-10 z-10 animate-fade-in-up">
            <h1 class="font-heading text-2xl sm:text-4xl md:text-5xl font-bold text-white tracking-tight mb-4 drop-shadow-2xl max-w-4xl mx-auto leading-snug px-2">
                <span x-show="lang === 'en'">Instrumental Music School</span>
                <span x-show="lang === 'ua'" x-cloak>Інструментальна Школа</span>
            </h1>
        </div>
        <div class="absolute bottom-0 left-0 w-full overflow-hidden leading-[0] z-20 pointer-events-none">
            <svg class="relative block w-full h-[40px] sm:h-[100px]" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none"><path d="M985.66,92.83C906.67,72,823.78,31,743.84,14.19c-82.26-17.34-168.06-16.33-250.45.39-57.84,11.73-114,31.07-172,41.86A600.21,600.21,0,0,1,0,27.35V120H1200V95.8C1132.19,118.92,1055.71,111.31,985.66,92.83Z" class="fill-[#f8fafc]"></path></svg>
        </div>
    </div>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12 space-y-8 sm:space-y-12 relative z-30 -mt-20 sm:-mt-24 pointer-events-auto w-full">

        <div class="bg-gradient-to-r from-slate-900 to-slate-800 rounded-2xl shadow-xl border border-slate-700 p-5 sm:p-6 flex flex-col sm:flex-row items-center justify-between gap-4 sm:gap-6 relative z-20 animate-fade-in-up" style="animation-delay: 0.1s;">
            <div class="flex items-center gap-4 text-center sm:text-left w-full sm:w-auto justify-center sm:justify-start">
                <div class="p-3 bg-brass/20 rounded-full hidden md:block shrink-0">
                    <svg class="w-8 h-8 text-brassLight" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/></svg>
                </div>
                <div>
                    <h2 class="text-white font-bold text-lg sm:text-xl font-heading tracking-wide">
                        <span x-show="lang === 'en'">Select Your Instrument</span>
                        <span x-show="lang === 'ua'" x-cloak>Оберіть Ваш Інструмент</span>
                    </h2>
                    <p class="text-slate-400 text-xs sm:text-sm mt-1">
                        <span x-show="lang === 'en'">Sheet music and tools will automatically adjust to proper ranges.</span>
                        <span x-show="lang === 'ua'" x-cloak>Ноти та інструменти автоматично підлаштуються під ваш діапазон.</span>
                    </p>
                </div>
            </div>
            <div class="relative w-full sm:w-72 shrink-0">
                <select x-model="globalInstrument" @change="updateGlobalInstrument($event.target.value)" class="w-full bg-slate-800 text-white border-2 border-slate-600 rounded-xl px-4 py-3 sm:px-5 sm:py-3.5 text-base sm:text-lg font-bold focus:outline-none focus:border-brass transition-colors cursor-pointer appearance-none shadow-inner">
                    <template x-for="inst in availableInstruments" :key="inst">
                        <option :value="inst" x-text="inst"></option>
                    </template>
                </select>
                <div class="absolute inset-y-0 right-0 flex items-center px-4 pointer-events-none">
                    <svg class="w-5 h-5 text-brass" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8 animate-fade-in-up" style="animation-delay: 0.2s;">
            <div class="bg-white rounded-2xl shadow-md border border-slate-200 p-5 sm:p-6 flex flex-col justify-between relative overflow-hidden transition-all duration-300 hover:shadow-lg">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h3 class="font-heading font-bold text-slate-900 text-base sm:text-lg">
                            <span x-show="lang === 'en'">Weekly Progress</span><span x-show="lang === 'ua'" x-cloak>Прогрес за тиждень</span>
                        </h3>
                        <p class="text-xs text-slate-500 mt-1">
                            <span x-show="lang === 'en'">Build your habit!</span><span x-show="lang === 'ua'" x-cloak>Формуйте звичку!</span>
                        </p>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl sm:text-3xl font-black text-brass leading-none" x-text="currentUser ? currentUser.streak : streak"></div>
                        <span class="text-[10px] text-slate-400 font-bold uppercase tracking-widest"><span x-show="lang === 'en'">Day Streak</span><span x-show="lang === 'ua'" x-cloak>Днів поспіль</span></span>
                    </div>
                </div>
                
                <div class="flex justify-between items-center bg-slate-50 p-3 rounded-xl border border-slate-100 mb-4">
                    <template x-for="(day, index) in weekDays" :key="index">
                        <div class="flex flex-col items-center gap-1.5">
                            <span class="text-[10px] font-bold text-slate-400" x-text="day"></span>
                            <div class="w-6 h-6 sm:w-8 sm:h-8 rounded-full flex items-center justify-center transition-colors duration-300"
                                 :class="hasPracticedOnDay(index) ? 'bg-emerald-100 text-emerald-600 border border-emerald-200' : (index === currentDayOfWeek ? 'bg-white border-2 border-slate-300' : 'bg-white border border-slate-200')">
                                <svg x-show="hasPracticedOnDay(index)" class="w-3.5 h-3.5 sm:w-4 sm:h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg>
                            </div>
                        </div>
                    </template>
                </div>
                
                <button @click="logPractice()" class="w-full py-3 rounded-xl font-bold text-xs sm:text-sm uppercase tracking-widest transition-all duration-300 shadow-sm border"
                    :class="practicedToday ? 'bg-emerald-50 text-emerald-700 border-emerald-200 cursor-default' : 'bg-slate-900 border-transparent text-white hover:bg-brass hover:shadow-md'">
                    <span x-show="!practicedToday">
                        <span x-show="lang === 'en'">Mark as Practiced ✓</span><span x-show="lang === 'ua'" x-cloak>Я займався сьогодні ✓</span>
                    </span>
                    <span x-show="practicedToday">
                        <span x-show="lang === 'en'">Done for today!</span><span x-show="lang === 'ua'" x-cloak>Готово на сьогодні!</span>
                    </span>
                </button>
            </div>

            <div class="bg-white rounded-2xl shadow-md border border-slate-200 p-6 sm:p-8 flex flex-col relative overflow-hidden transition-all duration-300 hover:shadow-lg">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4 border-b border-slate-100 pb-4">
                    <div>
                        <h3 class="font-heading font-bold text-slate-900 text-lg sm:text-2xl">
                            <span x-show="lang === 'en'">Guided Session</span><span x-show="lang === 'ua'" x-cloak>Таймер Занять</span>
                        </h3>
                    </div>
                    <div class="text-4xl sm:text-5xl font-mono font-black text-slate-900 tracking-tight" x-text="formatTime(sessionTimeLeft)">00:00</div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                    <template x-for="(phase, idx) in sessionPhases" :key="idx">
                        <button @click="startSessionPhase(idx)" 
                            class="flex flex-col items-start w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 text-left group"
                            :class="sessionPhase === idx && sessionActive ? 'bg-brass border-brass text-white shadow-md transform scale-[1.02]' : 'bg-slate-50 border-slate-200 hover:border-brass hover:bg-white text-slate-600'">
                            <div class="flex items-center gap-2 w-full mb-1">
                                <span class="font-bold text-xs uppercase tracking-widest" :class="sessionPhase === idx && sessionActive ? 'text-white' : 'text-slate-900'" x-text="lang === 'en' ? phase.name_en : phase.name_ua"></span>
                            </div>
                            <span class="text-xs font-mono font-bold opacity-80" x-text="formatTime(phase.duration)"></span>
                        </button>
                    </template>
                </div>
                
                <div class="flex flex-col sm:flex-row justify-between items-center mt-6 gap-4">
                    <div class="w-full bg-slate-100 h-2.5 rounded-full overflow-hidden shadow-inner">
                        <div class="bg-brass h-full transition-all duration-1000 ease-linear" :style="sessionActive ? `width: ${(1 - sessionTimeLeft / sessionPhases[sessionPhase].duration) * 100}%` : 'width: 0%'"></div>
                    </div>
                    <button @click="toggleSession()" class="w-full sm:w-auto bg-slate-900 text-white px-8 py-3 rounded-xl font-bold text-xs uppercase tracking-widest hover:bg-brass transition-all duration-300 shadow-md flex-shrink-0" x-text="sessionActive ? (lang === 'en' ? 'Pause Timer' : 'Пауза') : (lang === 'en' ? 'Start Timer' : 'Старт')"></button>
                </div>
            </div>
        </div>

        <section id="warmups" class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden scroll-mt-24 transition-all duration-300 hover:shadow-md animate-fade-in-up" style="animation-delay: 0.3s;">
            <div class="px-5 sm:px-6 py-5 sm:py-6 border-b border-slate-100 flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                <div>
                    <h2 class="font-heading text-xl font-bold text-slate-900">
                        <span x-show="lang === 'en'">Daily Warm-Ups</span>
                        <span x-show="lang === 'ua'" x-cloak>Щоденна Розминка</span>
                    </h2>
                    <p class="text-xs text-slate-500 mt-1">
                        <span x-show="lang === 'en'">Click any sheet to expand and open the auto-player.</span>
                        <span x-show="lang === 'ua'" x-cloak>Натисніть на ноти для розгортання та авто-плеєра.</span>
                    </p>
                </div>
                <div class="flex items-center justify-center gap-2 bg-slate-50 px-3 py-1.5 rounded-lg border border-slate-200">
                    <span class="text-[10px] sm:text-xs text-slate-500 font-bold uppercase tracking-wider">
                        <span x-show="lang === 'en'">Transposed for:</span>
                        <span x-show="lang === 'ua'" x-cloak>Транспоновано для:</span>
                    </span>
                    <span class="text-xs sm:text-sm text-brass font-black tracking-wide" x-text="globalInstrument"></span>
                </div>
            </div>
            
            <div class="p-4 sm:p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 bg-slate-50/50">
                <template x-for="(ex, index) in exercises" :key="index">
                    <div @click="openFullScreen(index, 'exercises')" class="bg-white rounded-xl border border-slate-200 p-4 sm:p-5 shadow-sm transform transition-all hover:-translate-y-1 hover:border-brass hover:shadow-md cursor-pointer group relative flex flex-col overflow-hidden">
                        <div class="flex justify-between items-center mb-3 border-b border-slate-100 pb-2">
                            <h3 class="font-heading text-xs sm:text-sm font-bold text-slate-900 tracking-wider group-hover:text-brass transition-colors truncate pr-2">
                                <span x-show="lang === 'en'" x-text="ex.title_en"></span>
                                <span x-show="lang === 'ua'" x-cloak x-text="ex.title_ua"></span>
                            </h3>
                            <div class="bg-slate-50 p-1.5 rounded-lg group-hover:bg-brass/10 transition-colors flex-shrink-0 text-slate-400 group-hover:text-brass flex items-center gap-1">
                                <span class="text-[9px] font-bold uppercase tracking-widest hidden sm:block">Open</span>
                                <svg class="w-3.5 h-3.5 sm:w-4 sm:h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" /></svg>
                            </div>
                        </div>
                        <div class="w-full overflow-x-auto min-h-[60px] sm:min-h-[80px] pointer-events-none flex items-center justify-start sm:justify-center opacity-80 group-hover:opacity-100 transition-opacity">
                            <div :id="'abc-warmup-' + index" class="w-full min-w-min"></div>
                        </div>
                    </div>
                </template>
            </div>
        </section>

        <section id="scales" class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden scroll-mt-24 transition-all duration-300 hover:shadow-md animate-fade-in-up" style="animation-delay: 0.4s;">
            <div class="px-5 sm:px-6 py-5 sm:py-6 border-b border-slate-100 flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                <div>
                    <h2 class="font-heading text-xl font-bold text-slate-900">
                        <span x-show="lang === 'en'">Fundamental Scales</span>
                        <span x-show="lang === 'ua'" x-cloak>Базові Гамми</span>
                    </h2>
                    <p class="text-xs text-slate-500 mt-1">
                        <span x-show="lang === 'en'">Standard pedagogical ranges for your specific instrument.</span>
                        <span x-show="lang === 'ua'" x-cloak>Стандартні діапазони для вашого інструменту.</span>
                    </p>
                </div>
            </div>
            
            <div class="p-4 sm:p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 bg-slate-50/50">
                <template x-for="(sc, index) in scales" :key="'sc'+index">
                    <div @click="openFullScreen(index, 'scales')" class="bg-white rounded-xl border border-slate-200 p-4 sm:p-5 shadow-sm transform transition-all hover:-translate-y-1 hover:border-brass hover:shadow-md cursor-pointer group relative flex flex-col overflow-hidden">
                        <div class="flex justify-between items-center mb-3 border-b border-slate-100 pb-2">
                            <h3 class="font-heading text-xs sm:text-sm font-bold text-slate-900 tracking-wider group-hover:text-brass transition-colors truncate pr-2">
                                <span x-show="lang === 'en'" x-text="sc.title_en"></span>
                                <span x-show="lang === 'ua'" x-cloak x-text="sc.title_ua"></span>
                            </h3>
                            <div class="bg-slate-50 p-1.5 rounded-lg group-hover:bg-brass/10 transition-colors flex-shrink-0 text-slate-400 group-hover:text-brass flex items-center gap-1">
                                <span class="text-[9px] font-bold uppercase tracking-widest hidden sm:block">Open</span>
                                <svg class="w-3.5 h-3.5 sm:w-4 sm:h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" /></svg>
                            </div>
                        </div>
                        <div class="w-full overflow-x-auto min-h-[60px] sm:min-h-[80px] pointer-events-none flex items-center justify-start sm:justify-center opacity-80 group-hover:opacity-100 transition-opacity">
                            <div :id="'abc-scale-' + index" class="w-full min-w-min"></div>
                        </div>
                    </div>
                </template>
            </div>
        </section>

        <section id="setlist" class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden scroll-mt-24 transition-all duration-300 hover:shadow-md animate-fade-in-up" style="animation-delay: 0.5s;">
            <div class="px-5 sm:px-6 py-5 sm:py-6 border-b border-slate-100 flex items-center justify-between">
                <h2 class="font-heading text-xl font-bold text-slate-900">
                    <span x-show="lang === 'en'">Current Repertoire</span><span x-show="lang === 'ua'" x-cloak>Поточний Репертуар</span>
                </h2>
                <span class="text-[10px] sm:text-xs font-bold bg-brass/10 text-brass px-2 sm:px-3 py-1 rounded-full uppercase tracking-wider" x-text="schoolSongs.length + (lang === 'en' ? ' Songs' : ' Пісень')"></span>
            </div>
            
            <div x-show="schoolSongs.length === 0" class="p-8 text-center text-slate-400 text-sm animate-pulse">Loading setlist from database...</div>

            <div x-show="schoolSongs.length > 0" class="p-4 sm:p-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 bg-slate-50/50">
                <template x-for="song in schoolSongs" :key="song.title">
                    <div class="bg-white rounded-xl border border-slate-200 p-4 sm:p-5 shadow-sm hover:shadow-md hover:border-brass transition-all duration-300 transform hover:-translate-y-1 flex flex-col group">
                        <div class="text-[9px] sm:text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2"><span x-show="lang === 'en'">Sheet Music</span><span x-show="lang === 'ua'" x-cloak>Ноти</span></div>
                        <h3 class="font-heading text-base sm:text-lg font-bold text-slate-900 mb-1 group-hover:text-brass transition-colors" x-text="song.title"></h3>
                        <p class="text-slate-500 text-xs sm:text-sm mb-4 flex-grow" x-text="lang === 'en' ? song.desc_en : song.desc_ua"></p>
                        <a :href="song.link" target="_blank" class="mt-auto text-[10px] sm:text-xs font-bold text-brass hover:text-brassLight flex items-center gap-1">
                            <svg class="w-3.5 h-3.5 sm:w-4 sm:h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
                            <span x-show="lang === 'en'">Open Music</span><span x-show="lang === 'ua'" x-cloak>Відкрити</span>
                        </a>
                    </div>
                </template>
            </div>
        </section>

        <section id="submission" class="bg-slate-900 rounded-2xl shadow-lg border border-slate-800 overflow-hidden relative transition-all duration-300 hover:shadow-xl animate-fade-in-up" style="animation-delay: 0.6s;">
            <div class="absolute top-0 right-0 p-32 bg-brass/10 blur-3xl rounded-full pointer-events-none"></div>
            <div x-show="submitStatus === 'success'" class="absolute inset-0 z-20 bg-emerald-600 flex flex-col items-center justify-center text-center p-6" x-transition><svg class="w-16 h-16 text-white mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg><h3 class="text-2xl font-bold text-white"><span x-show="lang === 'en'">Submitted Successfully!</span><span x-show="lang === 'ua'" x-cloak>Успішно надіслано!</span></h3></div>
            
            <div class="p-6 sm:p-8 relative z-10 grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div>
                    <span class="inline-block px-3 py-1 bg-brass/20 text-brassLight text-[10px] font-extrabold uppercase tracking-widest rounded-full mb-4">Feedback Tool</span>
                    <h3 class="font-heading text-2xl sm:text-3xl font-bold text-white mb-2"><span x-show="lang === 'en'">Playing Test Submissions</span><span x-show="lang === 'ua'" x-cloak>Здача Партій</span></h3>
                    <p class="text-slate-400 text-sm leading-relaxed mb-6"><span x-show="lang === 'en'">Record your assigned piece or scale and upload it directly for feedback from the conductor. Please include your instrument and song name.</span><span x-show="lang === 'ua'" x-cloak>Запишіть задану п'єсу або гамму та завантажте сюди для перевірки диригентом.</span></p>
                </div>
                
                <form x-ref="testForm" @submit.prevent="submitTest" name="playing_test" method="POST" data-netlify="true" enctype="multipart/form-data" class="bg-slate-800/50 border border-slate-700 p-5 rounded-xl space-y-4">
                    <input type="hidden" name="form-name" value="playing_test" />
                    <input type="text" name="name" required :placeholder="lang === 'en' ? 'Student Name' : 'Ім\'я Учня'" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-sm text-white placeholder-slate-500 focus:outline-none focus:border-brass transition-colors">
                    <input type="text" name="song" required :placeholder="lang === 'en' ? 'Song / Scale Name' : 'Назва твору / гамми'" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-sm text-white placeholder-slate-500 focus:outline-none focus:border-brass transition-colors">
                    <div class="relative w-full">
                        <input type="file" name="recording" accept="audio/*,video/*" required class="block w-full text-sm text-slate-400 file:mr-4 file:py-2.5 file:px-4 file:rounded-lg file:border-0 file:text-xs file:font-bold file:bg-slate-700 file:text-white hover:file:bg-slate-600 focus:outline-none cursor-pointer bg-slate-900 border border-slate-700 rounded-lg pr-4">
                    </div>
                    <button type="submit" class="w-full bg-brass hover:bg-brassLight text-white font-bold text-sm py-3.5 rounded-lg transition-colors shadow-lg disabled:opacity-50" :disabled="submitStatus === 'submitting'"><span x-show="submitStatus === 'idle'"><span x-show="lang === 'en'">Upload Recording</span><span x-show="lang === 'ua'" x-cloak>Завантажити Запис</span></span><span x-show="submitStatus === 'submitting'">Uploading...</span></button>
                </form>
            </div>
        </section>

        <section id="tools-resources" class="scroll-mt-24 transition-all duration-300 animate-fade-in-up" style="animation-delay: 0.7s;">
            <div class="px-2 py-6 border-b border-slate-200 mb-6 flex flex-col sm:flex-row sm:items-center justify-between gap-2">
                <h2 class="font-heading text-xl sm:text-2xl font-bold text-slate-900">
                    <span x-show="lang === 'en'">Tools & Resources</span>
                    <span x-show="lang === 'ua'" x-cloak>Інструменти та Матеріали</span>
                </h2>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8 w-full">
                <div class="lg:col-span-1 space-y-6 sm:space-y-8 w-full flex flex-col">
                    
                    <div class="bg-slate-900 p-5 sm:p-6 rounded-2xl shadow-lg border border-slate-800 relative overflow-hidden transition-all duration-300 flex flex-col flex-grow">
                        <div class="flex justify-between items-center mb-6 border-b border-slate-800 pb-3">
                            <span class="text-xs sm:text-sm font-bold text-slate-400 uppercase tracking-wider"><span x-show="lang === 'en'">Live Tuner</span><span x-show="lang === 'ua'" x-cloak>Тюнер</span></span>
                            <button @click="toggleTuner()" class="text-[10px] font-bold uppercase tracking-widest px-3 py-1 rounded-full border transition-colors focus:outline-none" :class="tunerActive ? 'bg-red-500/20 text-red-400 border-red-500/50' : 'bg-transparent text-brass border-brass hover:bg-brass hover:text-white'" x-text="tunerActive ? (lang === 'en' ? 'Stop' : 'Вимк') : (lang === 'en' ? 'Mic Access' : 'Мікрофон')"></button>
                        </div>
                        
                        <div class="flex flex-col items-center justify-center flex-grow min-h-[140px]">
                            <div x-show="!tunerActive" class="text-center text-slate-500 text-sm font-medium">
                                <span x-show="lang === 'en'">Click "Mic Access" to enable live tuner.</span><span x-show="lang === 'ua'" x-cloak>Натисніть "Мікрофон" для активації.</span>
                            </div>
                            <div x-show="tunerActive" class="flex flex-col items-center w-full" x-cloak>
                                <div class="text-5xl font-black text-white mb-2" x-text="tunerNote">--</div>
                                <div class="text-xs font-mono font-bold" :class="Math.abs(tunerCents) < 10 ? 'text-emerald-400' : (tunerCents > 0 ? 'text-rose-400' : 'text-amber-400')" x-text="tunerCents === 0 ? 'In Tune' : (tunerCents > 0 ? '+' + tunerCents + ' Sharp' : tunerCents + ' Flat')"></div>
                                <div class="w-full max-w-[200px] h-2 bg-slate-800 rounded-full mt-6 relative shadow-inner">
                                    <div class="absolute top-1/2 left-1/2 w-0.5 h-4 bg-slate-600 -translate-x-1/2 -translate-y-1/2"></div>
                                    <div class="absolute top-1/2 w-3 h-3 rounded-full shadow-[0_0_10px_rgba(255,255,255,0.5)] -translate-x-1/2 -translate-y-1/2 transition-all duration-75"
                                         :class="Math.abs(tunerCents) < 10 ? 'bg-emerald-400' : 'bg-brass'"
                                         :style="`left: ${Math.max(0, Math.min(100, 50 + (tunerCents / 2)))}%`"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-5 sm:p-6 rounded-2xl shadow-sm border border-slate-200 relative overflow-hidden transition-all duration-300 hover:shadow-md">
                        <div class="flex justify-between items-center mb-6 border-b border-slate-100 pb-3">
                            <span class="text-xs sm:text-sm font-bold text-slate-900 uppercase tracking-wider"><span x-show="lang === 'en'">Metronome</span><span x-show="lang === 'ua'" x-cloak>Метроном</span></span>
                            <div class="flex items-center gap-2 bg-slate-50 px-3 py-1.5 sm:px-4 sm:py-2 rounded-full shadow-inner border border-slate-200">
                                <div class="h-2.5 w-2.5 sm:h-3 sm:w-3 rounded-full bg-slate-300 transition-colors duration-75" :class="isMetronomePlaying ? 'bg-red-500 scale-110 shadow-[0_0_10px_rgba(239,68,68,0.5)]' : ''"></div>
                                <span class="text-xl sm:text-2xl font-mono font-bold text-slate-900" x-text="bpm"></span>
                                <span class="text-[10px] sm:text-xs text-slate-500 font-bold mt-1">BPM</span>
                            </div>
                        </div>
                        <input type="range" min="40" max="240" x-model="bpm" @input="updateMetronomeSpeed()" class="w-full mb-8">
                        <div class="grid grid-cols-2 gap-3 sm:gap-4">
                            <button @click="toggleMetronome()" class="py-3 sm:py-4 rounded-xl font-bold transition-all duration-300 text-xs sm:text-sm uppercase tracking-wide shadow-sm hover:shadow-md border transform hover:-translate-y-0.5" :class="isMetronomePlaying ? 'bg-white border-slate-300 text-slate-900' : 'bg-slate-900 border-transparent text-white hover:bg-slate-800'">
                                <span x-text="isMetronomePlaying ? (lang === 'en' ? 'Stop' : 'Стоп') : (lang === 'en' ? 'Start' : 'Старт')"></span>
                            </button>
                            <button @click="tapTempo()" class="py-3 sm:py-4 rounded-xl font-bold transition-all duration-300 text-xs sm:text-sm uppercase tracking-wide bg-brass/10 text-brass border border-brass/20 hover:bg-brass hover:text-white transform hover:-translate-y-0.5 hover:shadow-md">
                                <span x-show="lang === 'en'">Tap Tempo</span><span x-show="lang === 'ua'" x-cloak>Тап Темп</span>
                            </button>
                        </div>
                    </div>

                    <div class="bg-white p-5 sm:p-6 rounded-2xl shadow-sm border border-slate-200 flex flex-col transition-all duration-300 hover:shadow-md">
                        <div class="mb-4 border-b border-slate-100 pb-3">
                            <h3 class="font-heading text-xs sm:text-sm font-bold text-slate-900 uppercase tracking-wider">
                                <span x-show="lang === 'en'">Blank Sheet Music</span><span x-show="lang === 'ua'" x-cloak>Чисті Ноти</span>
                            </h3>
                            <p class="text-[9px] sm:text-[10px] text-slate-500 font-bold uppercase tracking-widest mt-1">
                                <span x-show="lang === 'en'">Print directly from your browser.</span><span x-show="lang === 'ua'" x-cloak>Друкуйте прямо з браузера.</span>
                            </p>
                        </div>
                        <div class="space-y-3 flex-grow">
                            <button @click="printStaves(10)" class="w-full flex items-center justify-between p-3 rounded-xl bg-slate-50 border border-slate-200 hover:border-brass transition-all duration-200 group">
                                <span class="font-bold text-xs sm:text-sm text-slate-700 group-hover:text-brass transition-colors"><span x-show="lang === 'en'">Print 10 Staves</span><span x-show="lang === 'ua'" x-cloak>Друк 10 рядків</span></span>
                                <svg class="w-4 h-4 text-slate-400 group-hover:text-brass transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" /></svg>
                            </button>
                            <button @click="printStaves(12)" class="w-full flex items-center justify-between p-3 rounded-xl bg-slate-50 border border-slate-200 hover:border-brass transition-all duration-200 group">
                                <span class="font-bold text-xs sm:text-sm text-slate-700 group-hover:text-brass transition-colors"><span x-show="lang === 'en'">Print 12 Staves</span><span x-show="lang === 'ua'" x-cloak>Друк 12 рядків</span></span>
                                <svg class="w-4 h-4 text-slate-400 group-hover:text-brass transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" /></svg>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-2 bg-white rounded-2xl shadow-sm border border-slate-200 flex flex-col transition-all duration-300 hover:shadow-md overflow-hidden w-full">
                    <div class="p-5 sm:p-6 border-b border-slate-100 bg-slate-50 flex flex-col sm:flex-row justify-between items-center gap-4">
                        <div class="text-center sm:text-left">
                            <h3 class="font-heading text-xl sm:text-2xl font-bold text-slate-900">
                                <span x-show="lang === 'en'">Interactive Fingering Chart</span><span x-show="lang === 'ua'" x-cloak>Інтерактивна Аплікатура</span>
                            </h3>
                        </div>
                        <div class="text-xs sm:text-sm font-black text-brass uppercase tracking-widest bg-white border border-slate-200 px-3 py-1.5 sm:px-4 sm:py-2 rounded-lg shadow-sm" x-text="globalInstrument"></div>
                    </div>
                    
                    <div class="p-4 sm:p-8 flex flex-col items-center flex-grow bg-white w-full relative">
                        <div class="flex justify-center gap-1.5 sm:gap-2 mb-6 sm:mb-8 bg-slate-100 p-1.5 rounded-full shadow-inner max-w-full overflow-x-auto w-full">
                            <template x-for="r in interactiveChart.ranges">
                                <button @click="interactiveChart.selectedRange = r; interactiveChart.selectedNote = 0; stopFingeringAudio();"
                                        class="px-4 py-1.5 sm:px-5 sm:py-2 text-[10px] sm:text-xs font-bold uppercase rounded-full transition-all duration-200 flex-1 sm:flex-none text-center"
                                        :class="interactiveChart.selectedRange === r ? 'bg-slate-800 text-white shadow-md' : 'text-slate-500 hover:bg-slate-200 hover:text-slate-900'"
                                        x-text="lang === 'en' ? r : (r === 'Low' ? 'Низька' : (r === 'Mid' ? 'Середня' : 'Висока'))"></button>
                            </template>
                        </div>
                        
                        <div class="flex flex-wrap gap-1.5 sm:gap-2.5 justify-center mb-6 sm:mb-8 w-full max-w-2xl min-h-[40px]">
                            <template x-for="(note, index) in interactiveChart.data[interactiveChart.instrument].notes[interactiveChart.selectedRange]">
                                <button @click="interactiveChart.selectedNote = index; stopFingeringAudio();"
                                    :class="interactiveChart.selectedNote === index ? 'bg-brass text-white shadow-md scale-105 border-brass' : 'bg-slate-50 text-slate-600 hover:bg-slate-200 hover:text-slate-900 border-slate-200'"
                                    class="px-2.5 py-1.5 sm:px-3 sm:py-2 rounded-lg font-bold text-xs sm:text-sm transition-all duration-200 border"
                                    x-text="note.name">
                                </button>
                            </template>
                        </div>

                        <div class="w-full max-w-lg bg-slate-50 border border-slate-200 shadow-inner rounded-2xl p-6 sm:p-10 flex flex-col justify-center items-center min-h-[200px] sm:min-h-[260px] overflow-hidden relative">
                            
                            <button @click="playFingeringAudio()" class="absolute top-4 right-4 bg-white border border-slate-200 hover:border-brass hover:text-brass text-slate-500 rounded-full p-2 sm:px-4 sm:py-2 shadow-sm flex items-center gap-2 transition-all duration-200 z-10 focus:outline-none" :class="isFingeringPlaying ? 'text-brass border-brass bg-brass/5 shadow-inner' : ''">
                                <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                                <span class="text-[10px] sm:text-xs font-bold uppercase tracking-widest hidden sm:block"><span x-show="lang === 'en'">Play Pitch</span><span x-show="lang === 'ua'" x-cloak>Звук</span></span>
                            </button>

                            <template x-if="interactiveChart.data[interactiveChart.instrument].type === 'valves'">
                                <div class="flex gap-4 sm:gap-8 mt-4 sm:mt-0">
                                    <template x-for="(v, i) in interactiveChart.data[interactiveChart.instrument].notes[interactiveChart.selectedRange][interactiveChart.selectedNote].val">
                                        <div class="flex flex-col items-center gap-3 sm:gap-4">
                                            <div class="w-12 h-12 sm:w-16 sm:h-16 rounded-full border-[4px] sm:border-[5px] shadow-md transition-all duration-300"
                                                 :class="v ? 'bg-brass border-brass scale-95 shadow-inner' : 'bg-white border-slate-300'"></div>
                                            <span class="font-black text-slate-400 text-xs sm:text-sm" x-text="i+1"></span>
                                        </div>
                                    </template>
                                </div>
                            </template>
                            
                            <template x-if="interactiveChart.data[interactiveChart.instrument].type === 'slide'">
                                <div class="flex flex-col items-center w-full max-w-md mt-4 sm:mt-0">
                                    <span class="text-5xl sm:text-6xl font-black text-brass mb-2 transition-all duration-300" x-text="interactiveChart.data[interactiveChart.instrument].notes[interactiveChart.selectedRange][interactiveChart.selectedNote].pos"></span>
                                    <span class="text-xs sm:text-sm font-bold text-slate-400 uppercase tracking-widest mb-6 sm:mb-8">
                                        <span x-show="lang === 'en'">Position</span><span x-show="lang === 'ua'" x-cloak>Позиція</span>
                                    </span>
                                    
                                    <div class="w-full h-4 sm:h-5 bg-slate-200 rounded-full relative flex items-center mt-2 mb-3 shadow-inner">
                                        <div class="absolute h-8 w-8 sm:h-10 sm:w-10 bg-brass rounded-full shadow-lg transition-all duration-500 ease-in-out border-[3px] sm:border-4 border-white"
                                             class="-ml-4 sm:-ml-5"
                                             :style="`left: ${ (interactiveChart.data[interactiveChart.instrument].notes[interactiveChart.selectedRange][interactiveChart.selectedNote].pos - 1) * (100 / 6) }%`"></div>
                                    </div>
                                    <div class="w-full flex justify-between mt-2 text-[10px] sm:text-xs font-bold text-slate-400 px-1">
                                        <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span>
                                    </div>
                                </div>
                            </template>
                            
                            <template x-if="interactiveChart.data[interactiveChart.instrument].type === 'woodwind'">
                                <div class="flex flex-col sm:flex-row items-center gap-6 sm:gap-10 mt-6 sm:mt-0">
                                    <div class="flex items-center gap-2 sm:gap-4 bg-white px-3 py-3 sm:px-5 sm:py-4 rounded-2xl border border-slate-200 shadow-sm">
                                        <span class="text-xs sm:text-sm font-bold text-slate-400 w-6 sm:w-8 text-right">LH</span>
                                        <div class="w-8 h-8 sm:w-10 sm:h-10 rounded-full border-[3px] sm:border-[4px] shadow-sm transition-all duration-300 flex-shrink-0"
                                             :class="interactiveChart.data[interactiveChart.instrument].notes[interactiveChart.selectedRange][interactiveChart.selectedNote].lh[0] ? 'bg-brass border-brass scale-95 shadow-inner' : 'bg-slate-50 border-slate-300'"></div>
                                        <div class="w-px h-10 sm:h-12 bg-slate-200 mx-1 sm:mx-2"></div>
                                        <div class="flex gap-1.5 sm:gap-3">
                                            <template x-for="i in [1, 2, 3]">
                                                <div class="w-8 h-8 sm:w-10 sm:h-10 rounded-full border-[3px] sm:border-[4px] shadow-sm transition-all duration-300 flex-shrink-0"
                                                     :class="interactiveChart.data[interactiveChart.instrument].notes[interactiveChart.selectedRange][interactiveChart.selectedNote].lh[i] ? 'bg-brass border-brass scale-95 shadow-inner' : 'bg-slate-50 border-slate-300'"></div>
                                            </template>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center gap-2 sm:gap-4 bg-white px-3 py-3 sm:px-5 sm:py-4 rounded-2xl border border-slate-200 shadow-sm">
                                        <span class="text-xs sm:text-sm font-bold text-slate-400 w-6 sm:w-8 text-right">RH</span>
                                        <div class="flex gap-1.5 sm:gap-3">
                                            <template x-for="i in [0, 1, 2]">
                                                <div class="w-8 h-8 sm:w-10 sm:h-10 rounded-full border-[3px] sm:border-[4px] shadow-sm transition-all duration-300 flex-shrink-0"
                                                     :class="interactiveChart.data[interactiveChart.instrument].notes[interactiveChart.selectedRange][interactiveChart.selectedNote].rh[i] ? 'bg-brass border-brass scale-95 shadow-inner' : 'bg-slate-50 border-slate-300'"></div>
                                            </template>
                                        </div>
                                        <div class="w-px h-10 sm:h-12 bg-slate-200 mx-1 sm:mx-2"></div>
                                        <div class="w-8 h-8 sm:w-10 sm:h-10 rounded-full border-[3px] sm:border-[4px] shadow-sm transition-all duration-300 flex-shrink-0"
                                             :class="interactiveChart.data[interactiveChart.instrument].notes[interactiveChart.selectedRange][interactiveChart.selectedNote].rh[3] ? 'bg-brass border-brass scale-95 shadow-inner' : 'bg-slate-50 border-slate-300'"></div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="bg-slate-900 rounded-2xl shadow-sm border border-slate-800 overflow-hidden flex flex-col transition-all duration-300 hover:shadow-lg mt-8">
            <div class="p-5 sm:p-6 border-b border-slate-800 bg-slate-800/50">
                <h3 class="font-heading text-base sm:text-lg font-bold text-white">
                    <span x-show="lang === 'en'">Musicianship Tips</span><span x-show="lang === 'ua'" x-cloak>Поради Музиканту</span>
                </h3>
                <p class="text-[10px] sm:text-xs text-slate-400 mt-1">
                    <span x-show="lang === 'en'">Preparing for the main band.</span><span x-show="lang === 'ua'" x-cloak>Підготовка до гри в оркестрі.</span>
                </p>
            </div>
            <div class="p-5 sm:p-6 space-y-4 flex-grow text-white">
                <details class="group">
                    <summary class="font-bold text-xs sm:text-sm cursor-pointer hover:text-brassLight transition-colors list-none flex justify-between items-center">
                        <span x-show="lang === 'en'">1. Posture & Air Support</span><span x-show="lang === 'ua'" x-cloak>1. Постава та Дихання</span>
                        <span class="transition-transform duration-300 group-open:rotate-180">▾</span>
                    </summary>
                    <p class="text-[10px] sm:text-xs text-slate-400 mt-2 leading-relaxed animate-fade-in-up">
                        <span x-show="lang === 'en'">Sit on the front half of your chair with feet flat. Good tone comes from deep, relaxed breathing from the diaphragm, not your chest.</span>
                        <span x-show="lang === 'ua'" x-cloak>Сидіть на передній половині стільця. Хороший звук вимагає глибокого, розслабленого дихання діафрагмою.</span>
                    </p>
                </details>
                <hr class="border-slate-800">
                <details class="group">
                    <summary class="font-bold text-xs sm:text-sm cursor-pointer hover:text-brassLight transition-colors list-none flex justify-between items-center">
                        <span x-show="lang === 'en'">2. Watching the Conductor</span><span x-show="lang === 'ua'" x-cloak>2. Увага на Диригента</span>
                        <span class="transition-transform duration-300 group-open:rotate-180">▾</span>
                    </summary>
                    <p class="text-[10px] sm:text-xs text-slate-400 mt-2 leading-relaxed animate-fade-in-up">
                        <span x-show="lang === 'en'">Adjust your music stand so you can see your sheet music AND the conductor out of your peripheral vision without moving your head.</span>
                        <span x-show="lang === 'ua'" x-cloak>Налаштуйте пульт так, щоб бачити ноти та диригента периферійним зором, не піднімаючи голови.</span>
                    </p>
                </details>
                <hr class="border-slate-800">
                <details class="group">
                    <summary class="font-bold text-xs sm:text-sm cursor-pointer hover:text-brassLight transition-colors list-none flex justify-between items-center">
                        <span x-show="lang === 'en'">3. Intonation (Tuning)</span><span x-show="lang === 'ua'" x-cloak>3. Інтонація (Строй)</span>
                        <span class="transition-transform duration-300 group-open:rotate-180">▾</span>
                    </summary>
                    <p class="text-[10px] sm:text-xs text-slate-400 mt-2 leading-relaxed animate-fade-in-up">
                        <span x-show="lang === 'en'">Listen to the players around you. If you hear "waves" or "beats" in the sound, you are out of tune. Adjust your tuning slide/mouthpiece until the sound is smooth.</span>
                        <span x-show="lang === 'ua'" x-cloak>Слухайте інших. Якщо ви чуєте "хвилі" або вібрації в звуці, ви не строїте. Налаштуйте інструмент, поки звук не стане рівним.</span>
                    </p>
                </details>
            </div>
        </section>

    </main>

    <footer class="bg-white border-t border-slate-200 py-12 text-center mt-auto">
        <div class="max-w-7xl mx-auto px-4 space-y-4">
            <div class="font-bold text-slate-900 tracking-tight text-lg">FUBC <span class="text-brass">MUSIC SCHOOL</span></div>
            <p class="text-xs text-slate-400">&copy; 2026 First Ukrainian Baptist Church Band.</p>
            <div class="flex flex-wrap justify-center gap-4 text-xs font-medium text-slate-500">
                <a href="/privacy.html" class="hover:text-brass transition-colors">Privacy Policy</a>
                <span class="hidden sm:inline">&bull;</span>
                <a href="https://ifob.su" target="_blank" class="hover:text-brass transition-colors">Sheet Music by IFOB</a>
            </div>
            <p class="text-[10px] sm:text-xs text-slate-400 mt-2 uppercase tracking-widest font-bold">Created and designed by Roman Kucheryavyy</p>
        </div>
    </footer>

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('schoolApp', () => ({
                // Initialize Supabase Client
                supabase: null,
                
                lang: 'en',
                mobileMenuOpen: false,
                
                fullScreenModalOpen: false,
                currentFullScreenIdx: 0,
                currentFullScreenType: 'exercises', 
                
                scrollY: 0,
                scrollProgress: 0,
                
                // AUTHENTICATION & PROFILE LOGIC
                profileModalOpen: false,
                authMode: 'login', // 'login' or 'register'
                authForm: { name: '', pin: '', code: '' },
                adminAccessCode: 'FUBC26', // Secret code for kids to register
                authLoading: false,
                
                currentUser: null,
                
                // --- DATABASE CLOUD SYNC ---
                async handleAuth() {
                    if(!this.authForm.name || !this.authForm.pin) return alert("Please enter name and PIN.");
                    if(!this.supabase) {
                        alert("Database not connected yet! Waiting for keys.");
                        return;
                    }

                    this.authLoading = true;
                    
                    if(this.authMode === 'register') {
                        if(this.authForm.code.toUpperCase() !== this.adminAccessCode) {
                            this.authLoading = false;
                            return alert("Invalid Access Code");
                        }
                        
                        // Check if user exists
                        const { data: existing } = await this.supabase.from('students').select('*').eq('name', this.authForm.name);
                        if(existing && existing.length > 0) {
                            this.authLoading = false;
                            return alert("Name already taken. Please login or use a different name.");
                        }

                        const newUser = {
                            name: this.authForm.name,
                            pin: this.authForm.pin,
                            total_minutes: 0,
                            streak: 0,
                            last_date: '',
                            log: []
                        };

                        const { data, error } = await this.supabase.from('students').insert([newUser]).select().single();
                        
                        if (error) { 
                            alert("Error creating account: " + error.message); 
                            this.authLoading = false;
                            return; 
                        }
                        
                        this.currentUser = data;
                        localStorage.setItem('fubc_cloud_user', JSON.stringify(this.currentUser));
                        this.loadUserDataLocally();
                    } else {
                        const { data, error } = await this.supabase.from('students').select('*').eq('name', this.authForm.name).eq('pin', this.authForm.pin).single();
                        
                        if (error || !data) {
                            alert("Incorrect Name or PIN. Or account does not exist.");
                        } else {
                            this.currentUser = data;
                            localStorage.setItem('fubc_cloud_user', JSON.stringify(this.currentUser));
                            this.loadUserDataLocally();
                        }
                    }
                    this.authLoading = false;
                },
                
                async saveUserToCloud() {
                    localStorage.setItem('fubc_cloud_user', JSON.stringify(this.currentUser));
                    if (!this.supabase) return;

                    const { error } = await this.supabase.from('students').update({
                        total_minutes: this.currentUser.total_minutes,
                        streak: this.currentUser.streak,
                        last_date: this.currentUser.last_date,
                        log: this.currentUser.log
                    }).eq('id', this.currentUser.id);

                    if(error) console.error("Failed to sync to cloud:", error);
                },

                logout() {
                    this.currentUser = null;
                    localStorage.removeItem('fubc_cloud_user');
                    this.authForm = { name: '', pin: '', code: '' };
                },

                loadUserDataLocally() {
                    this.studentName = this.currentUser.name;
                    this.totalMinutes = this.currentUser.total_minutes;
                    this.streak = this.currentUser.streak;
                    this.lastPractice = this.currentUser.last_date;
                    this.practicedLog = this.currentUser.log || [];
                },
                // -----------------------------

                studentName: localStorage.getItem('fubc_student_name') || '',
                isEditingName: false,
                totalMinutes: parseInt(localStorage.getItem('fubc_total_minutes')) || 0,
                
                openProfile() {
                    this.profileModalOpen = true;
                },

                getRankName() {
                    let hrs = (this.currentUser ? this.currentUser.total_minutes : this.totalMinutes) / 60;
                    if(hrs < 1) return this.lang === 'en' ? 'Beginner' : 'Початківець';
                    if(hrs < 5) return this.lang === 'en' ? 'Apprentice' : 'Учень';
                    if(hrs < 20) return this.lang === 'en' ? 'Musician' : 'Музикант';
                    if(hrs < 50) return this.lang === 'en' ? 'Section Leader' : 'Лідер групи';
                    return this.lang === 'en' ? 'Maestro' : 'Маестро';
                },
                getRankColor() {
                    let hrs = (this.currentUser ? this.currentUser.total_minutes : this.totalMinutes) / 60;
                    if(hrs < 5) return 'text-slate-500';
                    if(hrs < 20) return 'text-emerald-500';
                    if(hrs < 50) return 'text-blue-500';
                    return 'text-brass';
                },

                // --- INSTRUMENT GROUPS & TRANSPOSITION ---
                availableInstruments: ['Flute', 'Oboe', 'Clarinet', 'Saxophone', 'Trumpet', 'French Horn', 'Tenor Horn', 'Baritone', 'Trombone', 'Tuba'],
                globalInstrument: localStorage.getItem('fubc_school_instrument') || 'Trumpet',
                
                selectedGroup: 0,
                instrumentGroups: [
                    { clef: 'treble' }, // 0: Flute/Oboe (C Treble)
                    { clef: 'treble' }, // 1: Clarinet/Trumpet (Bb Treble)
                    { clef: 'treble' }, // 2: Sax/Eb Horn (Eb Treble)
                    { clef: 'treble' }, // 3: F Horn (F Treble)
                    { clef: 'bass' },   // 4: Trombone/Baritone (C Bass)
                    { clef: 'bass' }    // 5: Tuba (C Bass 8vb)
                ],

                // Weekly Practice Tracker
                streak: parseInt(localStorage.getItem('fubc_school_streak')) || 0,
                lastPractice: localStorage.getItem('fubc_school_last_date') || '',
                practicedToday: false,
                practicedLog: JSON.parse(localStorage.getItem('fubc_school_weekly_log')) || [],
                weekDays: ['S', 'M', 'T', 'W', 'T', 'F', 'S'],
                
                get currentDayOfWeek() { return new Date().getDay(); },

                hasPracticedOnDay(dayIndex) {
                    const logToCheck = this.currentUser ? this.currentUser.log : this.practicedLog;
                    if (!logToCheck) return false;
                    const today = new Date();
                    const dayDiff = today.getDay() - dayIndex;
                    const targetDate = new Date(today);
                    targetDate.setDate(today.getDate() - dayDiff);
                    return logToCheck.includes(targetDate.toDateString());
                },
                
                // Session Timer
                sessionActive: false,
                sessionTimer: null,
                sessionPhase: 0,
                sessionTimeLeft: 300, 
                sessionPhases: [
                    { name_en: 'Warm-Ups', name_ua: 'Розминка', duration: 300 },
                    { name_en: 'Repertoire', name_ua: 'Репертуар', duration: 900 },
                    { name_en: 'Review / Fun', name_ua: 'Повторення', duration: 300 } 
                ],

                submitStatus: 'idle',
                synthControl: null,
                
                // Fallback Setlist (If JSON fails)
                schoolSongs: [
                    { title: "Юношу Иосифа", desc_en: "Focus on rhythm.", desc_ua: "Точність ритму.", link: "https://ifob.su/band/instrumental/simple/yunoshu-iosifa/" },
                    { title: "Пока огонь", desc_en: "Focus on breath support.", desc_ua: "Увага на дихання.", link: "https://ifob.su/band/instrumental/simple/poka-ogoni-af/" },
                    { title: "Только", desc_en: "Work on finger technique.", desc_ua: "Робота над технікою пальців.", link: "https://ifob.su/band/instrumental/simple/tolko-ra/" },
                    { title: "Господь благослови", desc_en: "Maintain steady tempo.", desc_ua: "Тримайте рівний темп.", link: "https://ifob.su/band/instrumental/simple/g-blagoslovi-af/" },
                    { title: "Я маленький скиталец", desc_en: "Articulation and staccato.", desc_ua: "Артикуляція та стакато.", link: "https://ifob.su/band/for-children/ja-malenkiy-skitalets-orc-so/" },
                    { title: "Славьте Бога", desc_en: "Dynamics and full tone.", desc_ua: "Динаміка і повний звук.", link: "https://ifob.su/band/instrumental/simple/slavte-boga-ra/" },
                    { title: "Как овечку", desc_en: "Lyrical, flowing phrasing.", desc_ua: "Кантиленне фразування.", link: "https://ifob.su/band/instrumental/simple/kak-ovechku-ra/" },
                    { title: "Се у дверей", desc_en: "Watch for tempo shifts.", desc_ua: "Увага на зміни темпу.", link: "https://ifob.su/band/instrumental/simple/se-u-dverei-ra/" }
                ],

                // WARMUPS
                exercises: [
                    { 
                        title_en: '1. Long Tones', title_ua: '1. Довгі Ноти',
                        keys: ['Bb', 'C', 'G', 'F', 'Bb', 'Bb'],
                        abc: [
                            'L:1/4\nB c d e f g a b | b a g f e d c B | B8 |]', // Flute
                            'L:1/4\nC D E F G A B c | c B A G F E D C | C8 |]', // Clarinet
                            'L:1/4\nG A B c d e f g | g f e d c B A G | G8 |]', // Sax
                            'L:1/4\nF G A B c d e f | f e d c B A G F | F8 |]', // Horn
                            'L:1/4\nB,, C, D, E, F, G, A, B, | B, A, G, F, E, D, C, B,, | B,,8 |]', // Trombone
                            'L:1/4\nB,,, C,, D,, E,, F,, G,, A,, B,, | B,, A,, G,, F,, E,, D,, C,, B,,, | B,,,8 |]'  // Tuba
                        ] 
                    },
                    { 
                        title_en: '2. Flexibility', title_ua: '2. Гнучкість', 
                        keys: ['Bb', 'C', 'G', 'F', 'Bb', 'Bb'],
                        abc: [
                            'L:1/8\n(B f B f B2) z2 | (c g c g c2) z2 | (d a d a d2) z2 | (e b e b e2) z2 |]', 
                            'L:1/8\n(C G C G C2) z2 | (D A D A D2) z2 | (E B E B E2) z2 | (F c F c F2) z2 |]', 
                            'L:1/8\n(G d G d G2) z2 | (A e A e A2) z2 | (B f B f B2) z2 | (c g c g c2) z2 |]', 
                            'L:1/8\n(F c F c F2) z2 | (G d G d G2) z2 | (A e A e A2) z2 | (B f B f B2) z2 |]', 
                            'L:1/8\n(B,, F, B,, F, B,,2) z2 | (C, G, C, G, C,2) z2 | (D, A, D, A, D,2) z2 | (E, B, E, B, E,2) z2 |]', 
                            'L:1/8\n(B,,, F,, B,,, F,, B,,,2) z2 | (C,, G,, C,, G,, C,,2) z2 | (D,, A,, D,, A,, D,,2) z2 | (E,, B,, E,, B,, E,,2) z2 |]'
                        ] 
                    },
                    { 
                        title_en: '3. Articulation', title_ua: '3. Артикуляція', 
                        keys: ['Bb', 'C', 'G', 'F', 'Bb', 'Bb'],
                        abc: [
                            'L:1/8\n.B.B .B.B .B.B .B.B | B2 z2 B2 z2 | .f.f .f.f .f.f .f.f | f2 z2 f2 z2 |]', 
                            'L:1/8\n.C.C .C.C .C.C .C.C | C2 z2 C2 z2 | .G.G .G.G .G.G .G.G | G2 z2 G2 z2 |]', 
                            'L:1/8\n.G.G .G.G .G.G .G.G | G2 z2 G2 z2 | .d.d .d.d .d.d .d.d | d2 z2 d2 z2 |]', 
                            'L:1/8\n.F.F .F.F .F.F .F.F | F2 z2 F2 z2 | .c.c .c.c .c.c .c.c | c2 z2 c2 z2 |]', 
                            'L:1/8\n.B,,.B,, .B,,.B,, .B,,.B,, .B,,.B,, | B,,2 z2 B,,2 z2 | .F,.F, .F,.F, .F,.F, .F,.F, | F,2 z2 F,2 z2 |]', 
                            'L:1/8\n.B,,,.B,,, .B,,,.B,,, .B,,,.B,,, .B,,,.B,,, | B,,,2 z2 B,,,2 z2 | .F,,.F,, .F,,.F,, .F,,.F,, .F,,.F,, | F,,2 z2 F,,2 z2 |]'
                        ] 
                    },
                    { 
                        title_en: '4. Arpeggios', title_ua: '4. Арпеджіо', 
                        keys: ['Bb', 'C', 'G', 'F', 'Bb', 'Bb'],
                        abc: [
                            'L:1/8\nB d f b b f d B | B8 | c e g c\' c\' g e c | c8 |]', 
                            'L:1/8\nC E G c c G E C | C8 | D F A d d A F D | D8 |]', 
                            'L:1/8\nG B d g g d B G | G8 | A c e a a e c A | A8 |]', 
                            'L:1/8\nF A c f f c A F | F8 | G B d g g d B G | G8 |]', 
                            'L:1/8\nB,, D, F, B, B, F, D, B,, | B,,8 | C, E, G, C C G, E, C, | C,8 |]', 
                            'L:1/8\nB,,, D,, F,, B,, B,, F,, D,, B,,, | B,,,8 | C,, E,, G,, C, C, G,, E,, C,, | C,,8 |]'
                        ] 
                    }
                ],

                // FUNDAMENTAL SCALES
                scales: [
                    {
                        title_en: 'Concert Bb Major Scale', title_ua: 'Сі-бемоль мажор (Concert Bb)',
                        keys: ['Bb', 'C', 'G', 'F', 'Bb', 'Bb'],
                        abc: [
                            'L:1/8\nB c d e f g a b | b a g f e d c B | B8 |]', 
                            'L:1/8\nC D E F G A B c | c B A G F E D C | C8 |]', 
                            'L:1/8\nG A B c d e f g | g f e d c B A G | G8 |]', 
                            'L:1/8\nF G A B c d e f | f e d c B A G F | F8 |]', 
                            'L:1/8\nB,, C, D, E, F, G, A, B, | B, A, G, F, E, D, C, B,, | B,,8 |]', 
                            'L:1/8\nB,,, C,, D,, E,, F,, G,, A,, B,, | B,, A,, G,, F,, E,, D,, C,, B,,, | B,,,8 |]'
                        ]
                    },
                    {
                        title_en: 'Concert Eb Major Scale', title_ua: 'Мі-бемоль мажор (Concert Eb)',
                        keys: ['Eb', 'F', 'C', 'Bb', 'Eb', 'Eb'],
                        abc: [
                            'L:1/8\nE F G A B c d e | e d c B A G F E | E8 |]', 
                            'L:1/8\nF G A B c d e f | f e d c B A G F | F8 |]', 
                            'L:1/8\nC D E F G A B c | c B A G F E D C | C8 |]', 
                            'L:1/8\nB, C D E F G A B | B A G F E D C B, | B,8 |]', 
                            'L:1/8\nE,, F,, G,, A,, B,, C, D, E, | E, D, C, B,, A,, G,, F,, E,, | E,,8 |]', 
                            'L:1/8\nE,,, F,,, G,,, A,,, B,,, C,, D,, E,, | E,, D,, C,, B,,, A,,, G,,, F,,, E,,, | E,,,8 |]' 
                        ]
                    },
                    {
                        title_en: 'Concert F Major Scale', title_ua: 'Фа мажор (Concert F)',
                        keys: ['F', 'G', 'D', 'C', 'F', 'F'],
                        abc: [
                            'L:1/8\nF G A B c d e f | f e d c B A G F | F8 |]', 
                            'L:1/8\nG A B c d e f g | g f e d c B A G | G8 |]', 
                            'L:1/8\nD E F G A B c d | d c B A G F E D | D8 |]', 
                            'L:1/8\nC D E F G A B c | c B A G F E D C | C8 |]', 
                            'L:1/8\nF,, G,, A,, B,, C, D, E, F, | F, E, D, C, B,, A,, G,, F,, | F,,8 |]', 
                            'L:1/8\nF,,, G,,, A,,, B,,, C,, D,, E,, F,, | F,, E,, D,, C,, B,,, A,,, G,,, F,,, | F,,,8 |]' 
                        ]
                    },
                    {
                        title_en: 'Concert Ab Major Scale', title_ua: 'Ля-бемоль мажор (Concert Ab)',
                        keys: ['Ab', 'Bb', 'F', 'Eb', 'Ab', 'Ab'],
                        abc: [
                            'L:1/8\nA B c d e f g a | a g f e d c B A | A8 |]', 
                            'L:1/8\nB, C D E F G A B | B A G F E D C B, | B,8 |]', 
                            'L:1/8\nF G A B c d e f | f e d c B A G F | F8 |]', 
                            'L:1/8\nE F G A B c d e | e d c B A G F E | E8 |]', 
                            'L:1/8\nA,, B,, C, D, E, F, G, A, | A, G, F, E, D, C, B,, A,, | A,,8 |]', 
                            'L:1/8\nA,,, B,,, C,, D,, E,, F,, G,, A,, | A,, G,, F,, E,, D,, C,, B,,, A,,, | A,,,8 |]' 
                        ]
                    },
                    {
                        title_en: 'Concert C Major Scale', title_ua: 'До мажор (Concert C)',
                        keys: ['C', 'D', 'A', 'G', 'C', 'C'],
                        abc: [
                            'L:1/8\nC D E F G A B c | c B A G F E D C | C8 |]', 
                            'L:1/8\nD E F G A B c d | d c B A G F E D | D8 |]', 
                            'L:1/8\nA, B, C D E F G A | A G F E D C B, A, | A,8 |]', 
                            'L:1/8\nG, A, B, C D E F G | G F E D C B, A, G, | G,8 |]', 
                            'L:1/8\nC,, D,, E,, F,, G,, A,, B,, C, | C, B,, A,, G,, F,, E,, D,, C,, | C,,8 |]', 
                            'L:1/8\nC,,, D,,, E,,, F,,, G,,, A,,, B,,, C,, | C,, B,,, A,,, G,,, F,,, E,,, D,,, C,,, | C,,,8 |]' 
                        ]
                    }
                ],

                async init() {
                    // SETUP SUPABASE CONNECTION
                    const supabaseUrl = 'https://levtwocaqocalknouepf.supabase.co';
                    const supabaseKey = 'sb_publishable_BpPAx20IJLbntNt5pjZiAQ_jG3b4Joh';
                    
                    this.supabase = supabase.createClient(supabaseUrl, supabaseKey);

                    // Check for logged in cloud user
                    let storedCloudUser = localStorage.getItem('fubc_cloud_user');
                    if (storedCloudUser) {
                        this.currentUser = JSON.parse(storedCloudUser);
                        this.loadUserDataLocally();
                    }

                    const today = new Date();
                    today.setHours(0,0,0,0);

                    let logArr = this.currentUser ? (this.currentUser.log || []) : this.practicedLog;

                    const lastPracticedStr = logArr[logArr.length - 1];
                    if (lastPracticedStr) {
                        const last = new Date(lastPracticedStr);
                        const diffTime = today.getTime() - last.getTime();
                        const diffDays = Math.round(diffTime / (1000 * 60 * 60 * 24));
                        
                        if (today.getDay() < last.getDay() || diffDays > 6) {
                            if(this.currentUser) { this.currentUser.log = []; this.saveUserToCloud(); }
                            else { this.practicedLog = []; localStorage.setItem('fubc_school_weekly_log', JSON.stringify([])); }
                        }
                    }

                    let lastPrac = this.currentUser ? this.currentUser.last_date : this.lastPractice;
                    if (lastPrac) {
                        const last = new Date(lastPrac);
                        last.setHours(0,0,0,0);
                        const diffTime = today.getTime() - last.getTime();
                        const diffDays = Math.round(diffTime / (1000 * 60 * 60 * 24));
                        if (diffDays === 0) { this.practicedToday = true; } 
                        else if (diffDays > 1) { 
                            if(this.currentUser) { this.currentUser.streak = 0; this.saveUserToCloud(); }
                            else { this.streak = 0; localStorage.setItem('fubc_school_streak', 0); }
                        }
                    }
                    
                    try {
                        const response = await fetch('/data.json?t=' + new Date().getTime());
                        if (response.ok) {
                            const json = await response.json();
                            if(json.schoolSetlist && json.schoolSetlist.length > 0) { this.schoolSongs = json.schoolSetlist; }
                        }
                    } catch(e) { console.log('Offline - Using default fallback setlist.'); }

                    this.updateGlobalInstrument(this.globalInstrument);
                },

                get currentModalData() {
                    if(this.currentFullScreenType === 'exercises') return this.exercises[this.currentFullScreenIdx];
                    if(this.currentFullScreenType === 'scales') return this.scales[this.currentFullScreenIdx];
                    return {};
                },

                formatTime(seconds) {
                    const m = Math.floor(seconds / 60).toString().padStart(2, '0');
                    const s = (seconds % 60).toString().padStart(2, '0');
                    return `${m}:${s}`;
                },

                startSessionPhase(idx) {
                    this.sessionPhase = idx;
                    this.sessionTimeLeft = this.sessionPhases[idx].duration;
                    if(!this.sessionActive) {
                        this.sessionActive = true;
                        this.sessionTimer = setInterval(() => {
                            if (this.sessionTimeLeft > 0) {
                                this.sessionTimeLeft--;
                            } else {
                                clearInterval(this.sessionTimer);
                                this.sessionActive = false;
                                
                                let minsToAdd = Math.round(this.sessionPhases[this.sessionPhase].duration / 60);
                                if(this.currentUser) {
                                    this.currentUser.total_minutes += minsToAdd;
                                    this.saveUserToCloud();
                                } else {
                                    this.totalMinutes += minsToAdd;
                                    localStorage.setItem('fubc_total_minutes', this.totalMinutes);
                                }

                                if (this.sessionPhase < 2) {
                                    alert("Phase complete! Ready for the next one?");
                                } else {
                                    this.logPractice(); 
                                }
                            }
                        }, 1000);
                    }
                },

                toggleSession() {
                    if (this.sessionActive) {
                        clearInterval(this.sessionTimer);
                        this.sessionActive = false;
                        
                        let elapsedSeconds = this.sessionPhases[this.sessionPhase].duration - this.sessionTimeLeft;
                        if(elapsedSeconds > 60) {
                            let minsToAdd = Math.floor(elapsedSeconds / 60);
                            if(this.currentUser) {
                                this.currentUser.total_minutes += minsToAdd;
                                this.saveUserToCloud();
                            } else {
                                this.totalMinutes += minsToAdd;
                                localStorage.setItem('fubc_total_minutes', this.totalMinutes);
                            }
                            this.sessionTimeLeft = this.sessionPhases[this.sessionPhase].duration; 
                        }
                    } else {
                        this.startSessionPhase(this.sessionPhase);
                    }
                },

                updateGlobalInstrument(inst) {
                    this.globalInstrument = inst;
                    localStorage.setItem('fubc_school_instrument', inst);
                    
                    this.interactiveChart.instrument = inst;
                    this.interactiveChart.selectedNote = 0;
                    this.stopFingeringAudio();
                    
                    let groupIdx = 0;
                    if (['Flute', 'Oboe'].includes(inst)) groupIdx = 0;
                    else if (['Clarinet', 'Trumpet'].includes(inst)) groupIdx = 1;
                    else if (['Saxophone', 'Tenor Horn'].includes(inst)) groupIdx = 2;
                    else if (['French Horn'].includes(inst)) groupIdx = 3;
                    else if (['Trombone', 'Baritone'].includes(inst)) groupIdx = 4;
                    else if (['Tuba'].includes(inst)) groupIdx = 5;
                    
                    this.selectedGroup = groupIdx;
                    this.$nextTick(() => { 
                        this.renderWarmups(); 
                        this.renderScales();
                    });
                },

                renderWarmups() {
                    if (typeof ABCJS !== 'undefined') {
                        const group = this.instrumentGroups[this.selectedGroup];
                        const scale = window.innerWidth < 640 ? 0.8 : 1.0;
                        const options = { responsive: 'resize', scale: scale, paddingbottom: 5, paddingtop: 15, paddingleft: 0, paddingright: 0 };
                        this.exercises.forEach((ex, idx) => {
                            const header = `X:${idx+1}\nM:4/4\nQ:1/4=100\nK:${ex.keys[this.selectedGroup]} clef=${group.clef}\n`;
                            ABCJS.renderAbc(`abc-warmup-${idx}`, header + ex.abc[this.selectedGroup], options);
                        });
                    }
                },

                renderScales() {
                    if (typeof ABCJS !== 'undefined') {
                        const group = this.instrumentGroups[this.selectedGroup];
                        const scale = window.innerWidth < 640 ? 0.8 : 1.0;
                        const options = { responsive: 'resize', scale: scale, paddingbottom: 5, paddingtop: 15, paddingleft: 0, paddingright: 0 };
                        this.scales.forEach((sc, idx) => {
                            const header = `X:${idx+1}\nM:4/4\nQ:1/4=100\nK:${sc.keys[this.selectedGroup]} clef=${group.clef}\n`;
                            ABCJS.renderAbc(`abc-scale-${idx}`, header + sc.abc[this.selectedGroup], options);
                        });
                    }
                },

                openFullScreen(idx, type) {
                    this.currentFullScreenIdx = idx;
                    this.currentFullScreenType = type;
                    this.fullScreenModalOpen = true;
                    
                    this.$nextTick(() => {
                        const group = this.instrumentGroups[this.selectedGroup];
                        const dataObj = type === 'exercises' ? this.exercises[idx] : this.scales[idx];
                        const header = `X:${idx+1}\nM:4/4\nQ:1/4=100\nK:${dataObj.keys[this.selectedGroup]} clef=${group.clef}\n`;
                        const modalScale = window.innerWidth < 640 ? 1.0 : 1.8;
                        
                        var visualObj = ABCJS.renderAbc('abc-fullscreen', header + dataObj.abc[this.selectedGroup], { 
                            responsive: 'resize', scale: modalScale, paddingtop: 30, paddingbottom: 30, add_classes: true
                        })[0];

                        if(this.synthControl) { this.synthControl.pause(); }
                        this.synthControl = new ABCJS.synth.SynthController();
                        this.synthControl.load("#audio-control", null, { displayLoop: true, displayRestart: true, displayPlay: true, displayProgress: true, displayWarp: true });
                        
                        let program = 56; // Trumpet
                        if (group.clef === 'bass') program = 57; // Trombone
                        if (this.globalInstrument === 'Flute') program = 73;
                        if (this.globalInstrument === 'Clarinet') program = 71;
                        if (this.globalInstrument === 'Saxophone') program = 65;
                        if (this.globalInstrument === 'French Horn') program = 60;
                        if (this.globalInstrument === 'Tuba') program = 58;

                        var createSynth = new ABCJS.synth.CreateSynth();
                        createSynth.init({ visualObj: visualObj }).then(() => {
                            this.synthControl.setTune(visualObj, false, { program: program });
                        }).catch(console.warn);
                    });
                },

                closeFullScreen() {
                    this.fullScreenModalOpen = false;
                    if(this.synthControl) this.synthControl.pause();
                },

                logPractice() {
                    if(this.practicedToday) return;
                    this.practicedToday = true;
                    const todayStr = new Date().toDateString();
                    
                    if(this.currentUser) {
                        this.currentUser.streak++;
                        this.currentUser.last_date = todayStr;
                        if(!this.currentUser.log) this.currentUser.log = [];
                        if(!this.currentUser.log.includes(todayStr)) this.currentUser.log.push(todayStr);
                        this.currentUser.total_minutes += 30; // Baseline bump for clicking button
                        this.saveUserToCloud();
                    } else {
                        this.streak++;
                        this.lastPractice = todayStr;
                        if(!this.practicedLog.includes(todayStr)) {
                            this.practicedLog.push(todayStr);
                            localStorage.setItem('fubc_school_weekly_log', JSON.stringify(this.practicedLog));
                        }
                        this.totalMinutes += 30;
                        localStorage.setItem('fubc_total_minutes', this.totalMinutes);
                        localStorage.setItem('fubc_school_streak', this.streak);
                        localStorage.setItem('fubc_school_last_date', this.lastPractice);
                    }

                    if(typeof confetti === 'function') {
                        confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 }, colors: ['#b45309', '#d97706', '#fcd34d', '#34d399', '#3b82f6'], zIndex: 1000 });
                    }
                },

                // LIVE TUNER
                tunerActive: false,
                tunerNote: '--',
                tunerCents: 0,
                audioContext: null,
                analyser: null,
                micStream: null,
                animationId: null,

                toggleTuner() {
                    if (this.tunerActive) { this.stopTuner(); } else { this.startTuner(); }
                },

                async startTuner() {
                    try {
                        this.micStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        this.analyser = this.audioContext.createAnalyser();
                        this.analyser.fftSize = 2048;
                        const source = this.audioContext.createMediaStreamSource(this.micStream);
                        source.connect(this.analyser);
                        this.tunerActive = true;
                        this.updatePitch();
                    } catch (err) {
                        alert("Microphone access denied.");
                    }
                },

                stopTuner() {
                    if (this.micStream) this.micStream.getTracks().forEach(t => t.stop());
                    if (this.audioContext) this.audioContext.close();
                    if (this.animationId) cancelAnimationFrame(this.animationId);
                    this.tunerActive = false;
                    this.tunerNote = '--';
                    this.tunerCents = 0;
                },

                updatePitch() {
                    if (!this.tunerActive) return;
                    const buffer = new Float32Array(this.analyser.fftSize);
                    this.analyser.getFloatTimeDomainData(buffer);
                    const acFreq = this.autoCorrelate(buffer, this.audioContext.sampleRate);
                    
                    if (acFreq !== -1) {
                        const noteNum = 12 * (Math.log(acFreq / 440) / Math.log(2));
                        const noteIndex = Math.round(noteNum) + 69;
                        const notes = ['C', 'C#', 'D', 'Eb', 'E', 'F', 'F#', 'G', 'G#', 'A', 'Bb', 'B'];
                        this.tunerNote = notes[noteIndex % 12];
                        
                        const expectedFreq = 440 * Math.pow(2, (noteIndex - 69) / 12);
                        this.tunerCents = Math.floor(1200 * Math.log2(acFreq / expectedFreq));
                    }
                    this.animationId = requestAnimationFrame(() => this.updatePitch());
                },

                autoCorrelate(buf, sampleRate) {
                    let SIZE = buf.length;
                    let rms = 0;
                    for (let i=0;i<SIZE;i++) rms += buf[i]*buf[i];
                    rms = Math.sqrt(rms/SIZE);
                    if (rms<0.01) return -1; 
                    let r1=0, r2=SIZE-1, thres=0.2;
                    for(let i=0; i<SIZE/2; i++) if (Math.abs(buf[i])<thres) { r1=i; break; }
                    for(let i=1; i<SIZE/2; i++) if (Math.abs(buf[SIZE-i])<thres) { r2=SIZE-i; break; }
                    buf = buf.slice(r1,r2);
                    SIZE = buf.length;
                    let c = new Array(SIZE).fill(0);
                    for (let i=0; i<SIZE; i++) { for (let j=0; j<SIZE-i; j++) { c[i] = c[i] + buf[j]*buf[j+i]; } }
                    let d=0; while (c[d]>c[d+1]) d++;
                    let maxval=-1, maxpos=-1;
                    for (let i=d; i<SIZE; i++) { if (c[i] > maxval) { maxval = c[i]; maxpos = i; } }
                    let T0 = maxpos;
                    let x1=c[T0-1], x2=c[T0], x3=c[T0+1];
                    let a = (x1 + x3 - 2*x2)/2;
                    let b = (x3 - x1)/2;
                    if (a) T0 = T0 - b/(2*a);
                    return sampleRate/T0;
                },

                // METRONOME
                bpm: 100, 
                isPlaying: false, 
                timer: null, 
                audioCtx: null,
                lastTap: 0,
                
                playClick() { 
                    if (!this.audioCtx) this.audioCtx = new (window.AudioContext || window.webkitAudioContext)(); 
                    const osc = this.audioCtx.createOscillator(); 
                    const gain = this.audioCtx.createGain(); 
                    osc.connect(gain); gain.connect(this.audioCtx.destination); 
                    osc.frequency.value = 1000; gain.gain.value = 1; 
                    osc.start(); gain.gain.exponentialRampToValueAtTime(0.001, this.audioCtx.currentTime + 0.1); 
                    osc.stop(this.audioCtx.currentTime + 0.1); 
                }, 
                toggleMetronome() { 
                    if (this.isPlaying) { clearInterval(this.timer); this.isPlaying = false; } 
                    else { this.isPlaying = true; this.playClick(); this.timer = setInterval(() => this.playClick(), (60 / this.bpm) * 1000); } 
                }, 
                updateSpeed() { 
                    if (this.isPlaying) { clearInterval(this.timer); this.timer = setInterval(() => this.playClick(), (60 / this.bpm) * 1000); } 
                },
                tapTempo() {
                    const now = Date.now();
                    if (this.lastTap && (now - this.lastTap) < 2000) {
                        this.bpm = Math.min(Math.max(Math.round(60000 / (now - this.lastTap)), 40), 240);
                        this.updateSpeed();
                    }
                    this.lastTap = now;
                },

                // FINGERING AUDIO
                isFingeringPlaying: false,
                oscillator: null,
                gainNode: null,
                filterNode: null,
                notes: [ { name: 'C', freq: 261.63 }, { name: 'C#', freq: 277.18 }, { name: 'D', freq: 293.66 }, { name: 'Eb', freq: 311.13 }, { name: 'E', freq: 329.63 }, { name: 'F', freq: 349.23 }, { name: 'F#', freq: 369.99 }, { name: 'G', freq: 392.00 }, { name: 'Ab', freq: 415.30 }, { name: 'A', freq: 440.00 }, { name: 'Bb', freq: 466.16 }, { name: 'B', freq: 493.88 } ],

                playFingeringAudio() {
                    if(this.isFingeringPlaying) {
                        this.stopFingeringAudio();
                        return;
                    }
                    
                    if (!this.audioCtx) this.audioCtx = new (window.AudioContext || window.webkitAudioContext)(); 
                    
                    let noteObj = this.interactiveChart.data[this.interactiveChart.instrument].notes[this.interactiveChart.selectedRange][this.interactiveChart.selectedNote];
                    let noteName = noteObj.name.split('/')[0].replace('↑', '');
                    
                    const matchingFreqObj = this.notes.find(n => n.name === noteName);
                    const baseFreq = matchingFreqObj ? matchingFreqObj.freq : 261.63;

                    let pitchOctave = 4;
                    if(this.interactiveChart.selectedRange === 'Low') pitchOctave = 3;
                    if(this.interactiveChart.selectedRange === 'High') pitchOctave = 5;
                    
                    if (['Trombone', 'Baritone', 'Tuba'].includes(this.interactiveChart.instrument)) pitchOctave -= 1;

                    const actualFreq = baseFreq * Math.pow(2, pitchOctave - 4);

                    this.oscillator = this.audioCtx.createOscillator(); 
                    this.gainNode = this.audioCtx.createGain(); 
                    this.filterNode = this.audioCtx.createBiquadFilter();

                    const inst = this.interactiveChart.instrument;
                    if (inst === 'Flute') { this.oscillator.type = 'sine'; this.filterNode.type = 'lowpass'; this.filterNode.frequency.value = 2000; } 
                    else if (inst === 'Clarinet') { this.oscillator.type = 'square'; this.filterNode.type = 'lowpass'; this.filterNode.frequency.value = 1500; } 
                    else if (inst === 'Oboe') { this.oscillator.type = 'sawtooth'; this.filterNode.type = 'bandpass'; this.filterNode.frequency.value = 1200; } 
                    else if (['Trumpet', 'Trombone', 'Tenor Horn', 'Baritone', 'Tuba'].includes(inst)) { this.oscillator.type = 'sawtooth'; this.filterNode.type = 'lowpass'; this.filterNode.frequency.value = 2500; } 
                    else if (inst === 'French Horn') { this.oscillator.type = 'triangle'; this.filterNode.type = 'lowpass'; this.filterNode.frequency.value = 800; } 
                    else { this.oscillator.type = 'sawtooth'; this.filterNode.type = 'lowpass'; this.filterNode.frequency.value = 3000; }

                    this.oscillator.frequency.setValueAtTime(actualFreq, this.audioCtx.currentTime); 
                    this.oscillator.connect(this.filterNode); 
                    this.filterNode.connect(this.gainNode);
                    this.gainNode.connect(this.audioCtx.destination);
                    
                    this.gainNode.gain.setValueAtTime(0, this.audioCtx.currentTime);
                    this.gainNode.gain.linearRampToValueAtTime(0.5, this.audioCtx.currentTime + 0.1);
                    this.gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioCtx.currentTime + 1.5);

                    this.oscillator.start(); 
                    this.isFingeringPlaying = true;
                    
                    setTimeout(() => { this.stopFingeringAudio(); }, 1500);
                },

                stopFingeringAudio() {
                    if (this.oscillator && this.gainNode) {
                        this.gainNode.gain.linearRampToValueAtTime(0, this.audioCtx.currentTime + 0.05);
                        setTimeout(() => { if(this.oscillator) { this.oscillator.stop(); this.oscillator.disconnect(); this.oscillator = null; } }, 50);
                    }
                    this.isFingeringPlaying = false;
                },

                // SUBMISSIONS
                submitTest(e) {
                    this.submitStatus = 'submitting';
                    const formData = new FormData(this.$refs.testForm);
                    fetch('/', { method: 'POST', body: formData })
                    .then(() => {
                        this.submitStatus = 'success';
                        confetti({ particleCount: 150, spread: 70, origin: { y: 0.7 }, colors: ['#b45309', '#d97706', '#ffffff'], zIndex: 1000 });
                        this.$refs.testForm.reset();
                        setTimeout(() => { this.submitStatus = 'idle'; }, 5000);
                    }).catch(() => { alert('Upload failed. Check your connection or file size.'); this.submitStatus = 'idle'; });
                },

                // PRINTING
                printStaves(count) {
                    const container = document.getElementById('print-staves');
                    container.innerHTML = '';
                    for(let i=0; i<count; i++) { container.innerHTML += `<div class='stave-group'><div class='stave'></div><div class='stave'></div><div class='stave'></div><div class='stave'></div><div class='stave'></div></div>`; }
                    window.print();
                },

                // FINGERING CHART DATA
                interactiveChart: {
                    instrument: 'Trumpet',
                    selectedRange: 'Mid',
                    selectedNote: 0,
                    ranges: ['Low', 'Mid', 'High'],
                    data: {
                        'Flute': { type: 'woodwind', notes: { 
                            'Low': [ { name: 'C', lh: [0,1,1,1], rh: [1,1,1,1] }, { name: 'D', lh: [1,1,1,1], rh: [1,1,1,0] }, { name: 'E', lh: [1,1,1,1], rh: [1,1,0,1] }, { name: 'F', lh: [1,1,1,1], rh: [1,0,0,1] }, { name: 'G', lh: [1,1,1,1], rh: [0,0,0,1] }, { name: 'A', lh: [1,1,1,0], rh: [0,0,0,1] }, { name: 'B', lh: [1,1,0,0], rh: [0,0,0,1] } ], 
                            'Mid': [ { name: 'C', lh: [0,1,0,0], rh: [0,0,0,1] }, { name: 'Db', lh: [0,0,0,0], rh: [0,0,0,1] }, { name: 'D', lh: [1,0,1,1], rh: [1,1,1,0] }, { name: 'Eb', lh: [1,0,1,1], rh: [1,1,1,1] }, { name: 'E', lh: [1,1,1,1], rh: [1,1,0,1] }, { name: 'F', lh: [1,1,1,1], rh: [1,0,0,1] }, { name: 'Gb', lh: [1,1,1,1], rh: [0,0,1,1] }, { name: 'G', lh: [1,1,1,1], rh: [0,0,0,1] }, { name: 'Ab', lh: [1,1,1,1], rh: [0,0,0,1] }, { name: 'A', lh: [1,1,1,0], rh: [0,0,0,1] }, { name: 'Bb', lh: [1,1,0,0], rh: [1,0,0,1] }, { name: 'B', lh: [1,1,0,0], rh: [0,0,0,1] }, { name: 'C↑', lh: [0,1,0,0], rh: [0,0,0,1] } ], 
                            'High': [ { name: 'C', lh: [0,1,0,0], rh: [0,0,0,1] }, { name: 'D', lh: [1,0,1,1], rh: [0,0,0,0] }, { name: 'E', lh: [1,1,1,0], rh: [1,1,0,1] }, { name: 'F', lh: [1,1,0,1], rh: [1,0,0,1] }, { name: 'G', lh: [1,0,1,1], rh: [0,0,0,1] }, { name: 'A', lh: [1,0,1,0], rh: [1,0,0,1] }, { name: 'B', lh: [1,0,0,0], rh: [0,0,0,1] } ] 
                        } },
                        'Oboe': { type: 'woodwind', notes: { 
                            'Low': [ { name: 'C', lh: [0,1,1,1], rh: [1,1,1,1] }, { name: 'D', lh: [0,1,1,1], rh: [1,1,1,0] }, { name: 'E', lh: [0,1,1,1], rh: [1,1,0,0] }, { name: 'F', lh: [0,1,1,1], rh: [1,0,0,0] }, { name: 'G', lh: [0,1,1,1], rh: [0,0,0,0] }, { name: 'A', lh: [0,1,1,0], rh: [0,0,0,0] }, { name: 'B', lh: [0,1,0,0], rh: [0,0,0,0] } ], 
                            'Mid': [ { name: 'C', lh: [0,0,1,0], rh: [0,0,0,0] }, { name: 'Db', lh: [0,0,0,0], rh: [0,0,0,0] }, { name: 'D', lh: [1,1,1,1], rh: [1,1,1,0] }, { name: 'Eb', lh: [1,1,1,1], rh: [1,1,1,1] }, { name: 'E', lh: [1,1,1,1], rh: [1,1,0,0] }, { name: 'F', lh: [1,1,1,1], rh: [1,0,0,0] }, { name: 'Gb', lh: [1,1,1,1], rh: [0,1,0,0] }, { name: 'G', lh: [1,1,1,1], rh: [0,0,0,0] }, { name: 'Ab', lh: [1,1,1,1], rh: [0,0,0,0] }, { name: 'A', lh: [1,1,1,0], rh: [0,0,0,0] }, { name: 'Bb', lh: [1,1,0,0], rh: [1,0,0,0] }, { name: 'B', lh: [1,1,0,0], rh: [0,0,0,0] }, { name: 'C↑', lh: [1,0,1,0], rh: [0,0,0,0] } ], 
                            'High': [ { name: 'C', lh: [1,0,1,0], rh: [0,0,0,0] }, { name: 'D', lh: [1,0,1,1], rh: [0,0,0,0] }, { name: 'E', lh: [1,0,1,0], rh: [1,0,0,0] }, { name: 'F', lh: [1,0,1,0], rh: [0,1,0,0] }, { name: 'G', lh: [1,0,1,0], rh: [0,0,0,0] }, { name: 'A', lh: [1,0,1,1], rh: [0,0,0,0] }, { name: 'B', lh: [1,0,0,0], rh: [0,0,0,0] } ] 
                        } },
                        'Clarinet': { type: 'woodwind', notes: { 
                            'Low': [ { name: 'E', lh: [1,1,1,1], rh: [1,1,1,1] }, { name: 'F', lh: [1,1,1,1], rh: [1,1,1,0] }, { name: 'G', lh: [1,1,1,1], rh: [1,1,0,0] }, { name: 'A', lh: [1,1,1,1], rh: [1,0,0,0] }, { name: 'B', lh: [1,1,1,1], rh: [0,0,0,0] }, { name: 'C', lh: [1,1,1,0], rh: [0,0,0,0] } ], 
                            'Mid': [ { name: 'C', lh: [1,1,1,0], rh: [0,0,0,0] }, { name: 'Db', lh: [1,1,1,0], rh: [0,0,0,0] }, { name: 'D', lh: [1,1,0,0], rh: [0,0,0,0] }, { name: 'Eb', lh: [1,1,0,0], rh: [0,0,0,0] }, { name: 'E', lh: [1,0,0,0], rh: [0,0,0,0] }, { name: 'F', lh: [0,0,0,0], rh: [0,0,0,0] }, { name: 'Gb', lh: [0,0,0,0], rh: [0,0,0,0] }, { name: 'G', lh: [0,0,0,0], rh: [0,0,0,0] }, { name: 'Ab', lh: [0,0,0,0], rh: [0,0,0,0] }, { name: 'A', lh: [0,0,0,0], rh: [0,0,0,0] }, { name: 'Bb', lh: [0,0,0,0], rh: [0,0,0,0] }, { name: 'B', lh: [1,1,1,1], rh: [1,1,1,1] }, { name: 'C↑', lh: [1,1,1,1], rh: [1,1,1,0] } ], 
                            'High': [ { name: 'C', lh: [1,1,1,1], rh: [1,1,1,0] }, { name: 'D', lh: [1,1,1,1], rh: [1,1,0,0] }, { name: 'E', lh: [1,1,1,1], rh: [1,0,0,0] }, { name: 'F', lh: [1,1,1,1], rh: [0,0,0,0] }, { name: 'G', lh: [1,1,1,0], rh: [0,0,0,0] }, { name: 'A', lh: [1,1,0,0], rh: [0,0,0,0] } ] 
                        } },
                        'Saxophone': { type: 'woodwind', notes: { 
                            'Low': [ { name: 'Bb', lh: [0,1,1,1], rh: [1,1,1,1] }, { name: 'C', lh: [0,1,1,1], rh: [1,1,1,0] }, { name: 'D', lh: [0,1,1,1], rh: [1,1,1,0] }, { name: 'E', lh: [0,1,1,1], rh: [1,1,0,0] }, { name: 'F', lh: [0,1,1,1], rh: [1,0,0,0] } ], 
                            'Mid': [ { name: 'G', lh: [0,1,1,1], rh: [0,0,0,0] }, { name: 'Ab', lh: [0,1,1,1], rh: [0,0,0,0] }, { name: 'A', lh: [0,1,1,0], rh: [0,0,0,0] }, { name: 'Bb', lh: [0,1,1,0], rh: [1,0,0,0] }, { name: 'B', lh: [0,1,0,0], rh: [0,0,0,0] }, { name: 'C', lh: [0,0,1,0], rh: [0,0,0,0] }, { name: 'Db', lh: [0,0,0,0], rh: [0,0,0,0] }, { name: 'D', lh: [1,1,1,1], rh: [1,1,1,0] }, { name: 'Eb', lh: [1,1,1,1], rh: [1,1,1,1] }, { name: 'E', lh: [1,1,1,1], rh: [1,1,0,0] }, { name: 'F', lh: [1,1,1,1], rh: [1,0,0,0] }, { name: 'Gb', lh: [1,1,1,1], rh: [0,1,0,0] }, { name: 'G↑', lh: [1,1,1,1], rh: [0,0,0,0] } ], 
                            'High': [ { name: 'G', lh: [1,1,1,1], rh: [0,0,0,0] }, { name: 'A', lh: [1,1,1,0], rh: [0,0,0,0] }, { name: 'B', lh: [1,1,0,0], rh: [0,0,0,0] }, { name: 'C', lh: [1,0,1,0], rh: [0,0,0,0] }, { name: 'D', lh: [1,0,0,0], rh: [0,0,0,0] }, { name: 'E', lh: [1,1,1,1], rh: [1,1,0,0] }, { name: 'F', lh: [1,1,0,1], rh: [1,0,0,0] } ] 
                        } },
                        'Trumpet': { type: 'valves', notes: { 
                            'Low': [ { name: 'F#', val: [1,1,1] }, { name: 'G', val: [1,0,1] }, { name: 'Ab', val: [0,1,1] }, { name: 'A', val: [1,1,0] }, { name: 'Bb', val: [1,0,0] }, { name: 'B', val: [0,1,0] }, { name: 'C', val: [0,0,0] } ], 
                            'Mid': [ { name: 'C', val: [0,0,0] }, { name: 'C#/Db', val: [1,1,1] }, { name: 'D', val: [1,0,1] }, { name: 'Eb', val: [0,1,1] }, { name: 'E', val: [1,1,0] }, { name: 'F', val: [1,0,0] }, { name: 'F#/Gb', val: [0,1,0] }, { name: 'G', val: [0,0,0] }, { name: 'Ab', val: [0,1,1] }, { name: 'A', val: [1,1,0] }, { name: 'Bb', val: [1,0,0] }, { name: 'B', val: [0,1,0] }, { name: 'C↑', val: [0,0,0] } ], 
                            'High': [ { name: 'C', val: [0,0,0] }, { name: 'D', val: [1,0,0] }, { name: 'E', val: [0,0,0] }, { name: 'F', val: [1,0,0] }, { name: 'G', val: [0,0,0] }, { name: 'A', val: [1,1,0] }, { name: 'B', val: [0,1,0] }, { name: 'C↑', val: [0,0,0] } ] 
                        } },
                        'French Horn': { type: 'valves', notes: { 
                            'Low': [ { name: 'C', val: [0,0,0] }, { name: 'D', val: [1,0,1] }, { name: 'E', val: [0,1,0] }, { name: 'F', val: [0,0,0] }, { name: 'G', val: [0,0,0] }, { name: 'A', val: [1,1,0] }, { name: 'B', val: [0,1,0] } ], 
                            'Mid': [ { name: 'C', val: [0,0,0] }, { name: 'Db', val: [1,1,0] }, { name: 'D', val: [1,0,0] }, { name: 'Eb', val: [0,1,0] }, { name: 'E', val: [0,0,0] }, { name: 'F', val: [1,0,0] }, { name: 'Gb', val: [0,1,0] }, { name: 'G', val: [0,0,0] }, { name: 'Ab', val: [0,1,1] }, { name: 'A', val: [1,1,0] }, { name: 'Bb', val: [1,0,0] }, { name: 'B', val: [0,1,0] }, { name: 'C↑', val: [0,0,0] } ], 
                            'High': [ { name: 'C', val: [0,0,0] }, { name: 'D', val: [1,0,0] }, { name: 'E', val: [0,0,0] }, { name: 'F', val: [1,0,0] }, { name: 'G', val: [0,0,0] }, { name: 'A', val: [1,1,0] }, { name: 'B', val: [0,1,0] }, { name: 'C↑', val: [0,0,0] } ] 
                        } },
                        'Tenor Horn': { type: 'valves', notes: { 
                            'Low': [ { name: 'F#', val: [1,1,1] }, { name: 'G', val: [1,0,1] }, { name: 'Ab', val: [0,1,1] }, { name: 'A', val: [1,1,0] }, { name: 'Bb', val: [1,0,0] }, { name: 'B', val: [0,1,0] }, { name: 'C', val: [0,0,0] } ], 
                            'Mid': [ { name: 'C', val: [0,0,0] }, { name: 'C#/Db', val: [1,1,1] }, { name: 'D', val: [1,0,1] }, { name: 'Eb', val: [0,1,1] }, { name: 'E', val: [1,1,0] }, { name: 'F', val: [1,0,0] }, { name: 'F#/Gb', val: [0,1,0] }, { name: 'G', val: [0,0,0] }, { name: 'Ab', val: [0,1,1] }, { name: 'A', val: [1,1,0] }, { name: 'Bb', val: [1,0,0] }, { name: 'B', val: [0,1,0] }, { name: 'C↑', val: [0,0,0] } ], 
                            'High': [ { name: 'C', val: [0,0,0] }, { name: 'D', val: [1,0,0] }, { name: 'E', val: [0,0,0] }, { name: 'F', val: [1,0,0] }, { name: 'G', val: [0,0,0] }, { name: 'A', val: [1,1,0] }, { name: 'B', val: [0,1,0] }, { name: 'C↑', val: [0,0,0] } ] 
                        } },
                        'Baritone': { type: 'valves', notes: { 
                            'Low': [ { name: 'E', val: [1,1,1] }, { name: 'F', val: [1,0,1] }, { name: 'G', val: [1,1,0] }, { name: 'Ab', val: [1,0,0] }, { name: 'A', val: [0,1,0] }, { name: 'Bb', val: [0,0,0] } ], 
                            'Mid': [ { name: 'Bb', val: [0,0,0] }, { name: 'B', val: [1,1,1] }, { name: 'C', val: [1,0,1] }, { name: 'Db', val: [0,1,1] }, { name: 'D', val: [1,1,0] }, { name: 'Eb', val: [1,0,0] }, { name: 'E', val: [0,1,0] }, { name: 'F', val: [0,0,0] }, { name: 'Gb', val: [0,1,1] }, { name: 'G', val: [1,1,0] }, { name: 'Ab', val: [1,0,0] }, { name: 'A', val: [0,1,0] }, { name: 'Bb↑', val: [0,0,0] } ], 
                            'High': [ { name: 'Bb', val: [0,0,0] }, { name: 'C', val: [1,0,0] }, { name: 'D', val: [1,1,0] }, { name: 'Eb', val: [1,0,0] }, { name: 'F', val: [0,0,0] }, { name: 'G', val: [0,0,0] }, { name: 'A', val: [0,1,0] }, { name: 'Bb↑', val: [0,0,0] } ] 
                        } },
                        'Trombone': { type: 'slide', notes: { 
                            'Low': [ { name: 'E', pos: 7 }, { name: 'F', pos: 6 }, { name: 'G', pos: 4 }, { name: 'Ab', pos: 3 }, { name: 'A', pos: 2 }, { name: 'Bb', pos: 1 } ], 
                            'Mid': [ { name: 'Bb', pos: 1 }, { name: 'B', pos: 7 }, { name: 'C', pos: 6 }, { name: 'Db', pos: 5 }, { name: 'D', pos: 4 }, { name: 'Eb', pos: 3 }, { name: 'E', pos: 2 }, { name: 'F', pos: 1 }, { name: 'Gb', pos: 5 }, { name: 'G', pos: 4 }, { name: 'Ab', pos: 3 }, { name: 'A', pos: 2 }, { name: 'Bb↑', pos: 1 } ], 
                            'High': [ { name: 'Bb', pos: 1 }, { name: 'C', pos: 3 }, { name: 'D', pos: 1 }, { name: 'Eb', pos: 3 }, { name: 'F', pos: 1 }, { name: 'G', pos: 2 }, { name: 'Ab', pos: 3 }, { name: 'Bb↑', pos: 1 } ] 
                        } },
                        'Tuba': { type: 'valves', notes: { 
                            'Low': [ { name: 'E', val: [1,1,1] }, { name: 'F', val: [1,0,1] }, { name: 'G', val: [1,1,0] }, { name: 'Ab', val: [1,0,0] }, { name: 'A', val: [0,1,0] }, { name: 'Bb', val: [0,0,0] } ], 
                            'Mid': [ { name: 'Bb', val: [0,0,0] }, { name: 'B', val: [1,1,1] }, { name: 'C', val: [1,0,1] }, { name: 'Db', val: [0,1,1] }, { name: 'D', val: [1,1,0] }, { name: 'Eb', val: [1,0,0] }, { name: 'E', val: [0,1,0] }, { name: 'F', val: [0,0,0] }, { name: 'Gb', val: [0,1,1] }, { name: 'G', val: [1,1,0] }, { name: 'Ab', val: [1,0,0] }, { name: 'A', val: [0,1,0] }, { name: 'Bb↑', val: [0,0,0] } ], 
                            'High': [ { name: 'Bb', val: [0,0,0] }, { name: 'C', val: [1,0,0] }, { name: 'D', val: [1,1,0] }, { name: 'Eb', val: [1,0,0] }, { name: 'F', val: [0,0,0] }, { name: 'G', val: [0,0,0] }, { name: 'A', val: [0,1,0] }, { name: 'Bb↑', val: [0,0,0] } ] 
                        } }
                    }
                }
            }));
        });
    </script>
</body>
</html>

